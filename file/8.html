<!DOCTYPE html >
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p8" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	-webkit-transform-origin: bottom left;
	-ms-transform-origin: bottom left;
	transform-origin: bottom left;
	-webkit-transform: scale(0.25);
	-ms-transform: scale(0.25);
	transform: scale(0.25);
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_8{left:83px;bottom:1085px;}
#t2_8{left:113px;bottom:1085px;}
#t3_8{left:83px;bottom:1064px;letter-spacing:-0.1px;word-spacing:9.9px;}
#t4_8{left:435px;bottom:1064px;}
#t5_8{left:443px;bottom:1064px;}
#t6_8{left:82px;bottom:1049px;word-spacing:10px;}
#t7_8{left:82px;bottom:1033px;letter-spacing:-0.1px;word-spacing:2.1px;}
#t8_8{left:82px;bottom:1018px;letter-spacing:-0.1px;word-spacing:10.3px;}
#t9_8{left:82px;bottom:1003px;word-spacing:1.1px;}
#ta_8{left:82px;bottom:988px;letter-spacing:-0.2px;word-spacing:3.4px;}
#tb_8{left:82px;bottom:972px;word-spacing:0.1px;}
#tc_8{left:101px;bottom:957px;word-spacing:6.1px;}
#td_8{left:82px;bottom:942px;word-spacing:9.5px;}
#te_8{left:82px;bottom:927px;word-spacing:7px;}
#tf_8{left:82px;bottom:912px;word-spacing:2.1px;}
#tg_8{left:82px;bottom:896px;letter-spacing:-0.1px;word-spacing:4.9px;}
#th_8{left:82px;bottom:881px;word-spacing:3px;}
#ti_8{left:82px;bottom:866px;word-spacing:3.3px;}
#tj_8{left:298px;bottom:866px;}
#tk_8{left:305px;bottom:865px;}
#tl_8{left:322px;bottom:866px;}
#tm_8{left:343px;bottom:866px;}
#tn_8{left:367px;bottom:866px;}
#to_8{left:374px;bottom:866px;}
#tp_8{left:381px;bottom:866px;}
#tq_8{left:413px;bottom:866px;word-spacing:3.2px;}
#tr_8{left:82px;bottom:851px;}
#ts_8{left:194px;bottom:851px;}
#tt_8{left:200px;bottom:850px;}
#tu_8{left:216px;bottom:851px;word-spacing:2px;}
#tv_8{left:259px;bottom:851px;}
#tw_8{left:101px;bottom:835px;letter-spacing:-0.2px;word-spacing:0.4px;}
#tx_8{left:90px;bottom:811px;}
#ty_8{left:102px;bottom:809px;word-spacing:7px;}
#tz_8{left:102px;bottom:794px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t10_8{left:102px;bottom:779px;}
#t11_8{left:90px;bottom:759px;}
#t12_8{left:102px;bottom:757px;}
#t13_8{left:90px;bottom:738px;}
#t14_8{left:102px;bottom:736px;word-spacing:0.9px;}
#t15_8{left:102px;bottom:721px;}
#t16_8{left:241px;bottom:721px;}
#t17_8{left:251px;bottom:721px;}
#t18_8{left:265px;bottom:721px;}
#t19_8{left:277px;bottom:721px;letter-spacing:15.7px;}
#t1a_8{left:299px;bottom:721px;}
#t1b_8{left:90px;bottom:701px;}
#t1c_8{left:102px;bottom:699px;word-spacing:14.4px;}
#t1d_8{left:102px;bottom:684px;word-spacing:-1.1px;}
#t1e_8{left:320px;bottom:685px;letter-spacing:2.7px;}
#t1f_8{left:372px;bottom:684px;word-spacing:-1.2px;}
#t1g_8{left:102px;bottom:669px;}
#t1h_8{left:131px;bottom:669px;letter-spacing:2.7px;}
#t1i_8{left:151px;bottom:669px;letter-spacing:-0.2px;word-spacing:2.1px;}
#t1j_8{left:351px;bottom:669px;letter-spacing:2.7px;}
#t1k_8{left:375px;bottom:669px;word-spacing:1.6px;}
#t1l_8{left:400px;bottom:669px;letter-spacing:2.7px;}
#t1m_8{left:102px;bottom:654px;letter-spacing:-0.2px;word-spacing:0.3px;}
#t1n_8{left:101px;bottom:627px;word-spacing:3.4px;}
#t1o_8{left:82px;bottom:612px;word-spacing:4.8px;}
#t1p_8{left:82px;bottom:597px;word-spacing:8.3px;}
#t1q_8{left:82px;bottom:582px;word-spacing:-1.9px;}
#t1r_8{left:82px;bottom:566px;}
#t1s_8{left:101px;bottom:551px;letter-spacing:-0.2px;word-spacing:0.3px;}
#t1t_8{left:90px;bottom:526px;}
#t1u_8{left:102px;bottom:525px;word-spacing:-1.5px;}
#t1v_8{left:102px;bottom:509px;word-spacing:1.6px;}
#t1w_8{left:102px;bottom:494px;letter-spacing:-0.1px;word-spacing:5.1px;}
#t1x_8{left:102px;bottom:479px;word-spacing:9.3px;}
#t1y_8{left:102px;bottom:464px;letter-spacing:-0.1px;word-spacing:7.1px;}
#t1z_8{left:102px;bottom:449px;}
#t20_8{left:90px;bottom:429px;}
#t21_8{left:102px;bottom:427px;word-spacing:-1.7px;}
#t22_8{left:102px;bottom:412px;letter-spacing:-0.1px;word-spacing:2.5px;}
#t23_8{left:102px;bottom:397px;}
#t24_8{left:90px;bottom:377px;}
#t25_8{left:102px;bottom:375px;word-spacing:16.3px;}
#t26_8{left:102px;bottom:360px;letter-spacing:-0.2px;word-spacing:0.3px;}
#t27_8{left:101px;bottom:334px;word-spacing:11.1px;}
#t28_8{left:82px;bottom:319px;letter-spacing:-0.1px;word-spacing:3.9px;}
#t29_8{left:82px;bottom:303px;}
#t2a_8{left:82px;bottom:275px;}
#t2b_8{left:113px;bottom:275px;}
#t2c_8{left:82px;bottom:254px;letter-spacing:-0.1px;word-spacing:13.1px;}
#t2d_8{left:82px;bottom:239px;letter-spacing:-0.1px;word-spacing:6.1px;}
#t2e_8{left:82px;bottom:224px;word-spacing:6.7px;}
#t2f_8{left:82px;bottom:208px;}
#t2g_8{left:89px;bottom:208px;}
#t2h_8{left:100px;bottom:208px;}
#t2i_8{left:116px;bottom:208px;word-spacing:1.1px;}
#t2j_8{left:148px;bottom:208px;}
#t2k_8{left:154px;bottom:208px;letter-spacing:9.4px;}
#t2l_8{left:168px;bottom:208px;}
#t2m_8{left:174px;bottom:208px;word-spacing:1.2px;}
#t2n_8{left:378px;bottom:208px;}
#t2o_8{left:385px;bottom:208px;}
#t2p_8{left:391px;bottom:208px;word-spacing:1.2px;}
#t2q_8{left:411px;bottom:208px;}
#t2r_8{left:418px;bottom:208px;}
#t2s_8{left:428px;bottom:208px;}
#t2t_8{left:82px;bottom:193px;}
#t2u_8{left:89px;bottom:193px;}
#t2v_8{left:99px;bottom:193px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t2w_8{left:82px;bottom:178px;letter-spacing:-0.1px;word-spacing:-0.4px;}
#t2x_8{left:82px;bottom:163px;letter-spacing:-0.1px;word-spacing:2.9px;}
#t2y_8{left:82px;bottom:147px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t2z_8{left:101px;bottom:132px;word-spacing:0.2px;}
#t30_8{left:270px;bottom:132px;}
#t31_8{left:284px;bottom:132px;letter-spacing:-0.2px;word-spacing:0.6px;}
#t32_8{left:337px;bottom:132px;}
#t33_8{left:348px;bottom:132px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t34_8{left:82px;bottom:117px;word-spacing:2.2px;}
#t35_8{left:370px;bottom:117px;}
#t36_8{left:376px;bottom:116px;}
#t37_8{left:391px;bottom:117px;word-spacing:2.2px;}
#t38_8{left:82px;bottom:102px;word-spacing:0.4px;}
#t39_8{left:311px;bottom:102px;}
#t3a_8{left:322px;bottom:102px;word-spacing:0.4px;}
#t3b_8{left:494px;bottom:1087px;letter-spacing:-2.2px;}
#t3c_8{left:533px;bottom:1087px;letter-spacing:-1.1px;word-spacing:2.2px;}
#t3d_8{left:605px;bottom:1087px;}
#t3e_8{left:494px;bottom:1071px;}
#t3f_8{left:533px;bottom:1071px;}
#t3g_8{left:605px;bottom:1071px;word-spacing:0.1px;}
#t3h_8{left:494px;bottom:1056px;}
#t3i_8{left:533px;bottom:1056px;}
#t3j_8{left:605px;bottom:1056px;}
#t3k_8{left:494px;bottom:1040px;}
#t3l_8{left:533px;bottom:1040px;}
#t3m_8{left:605px;bottom:1040px;}
#t3n_8{left:494px;bottom:1025px;}
#t3o_8{left:533px;bottom:1025px;}
#t3p_8{left:605px;bottom:1025px;}
#t3q_8{left:494px;bottom:1010px;}
#t3r_8{left:533px;bottom:1010px;}
#t3s_8{left:605px;bottom:1010px;}
#t3t_8{left:533px;bottom:995px;}
#t3u_8{left:533px;bottom:979px;}
#t3v_8{left:484px;bottom:953px;letter-spacing:-0.3px;word-spacing:7.4px;}
#t3w_8{left:484px;bottom:938px;letter-spacing:-0.1px;word-spacing:1.6px;}
#t3x_8{left:484px;bottom:922px;letter-spacing:-0.1px;word-spacing:1.7px;}
#t3y_8{left:484px;bottom:907px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t3z_8{left:484px;bottom:850px;word-spacing:4.8px;}
#t40_8{left:577px;bottom:850px;}
#t41_8{left:589px;bottom:850px;word-spacing:4.8px;}
#t42_8{left:676px;bottom:850px;}
#t43_8{left:683px;bottom:850px;}
#t44_8{left:694px;bottom:850px;letter-spacing:-0.2px;word-spacing:5.1px;}
#t45_8{left:484px;bottom:835px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t46_8{left:503px;bottom:820px;letter-spacing:-0.1px;word-spacing:9px;}
#t47_8{left:663px;bottom:820px;}
#t48_8{left:669px;bottom:819px;}
#t49_8{left:681px;bottom:820px;word-spacing:8.8px;}
#t4a_8{left:484px;bottom:805px;word-spacing:10.2px;}
#t4b_8{left:484px;bottom:790px;word-spacing:-0.6px;}
#t4c_8{left:484px;bottom:774px;}
#t4d_8{left:491px;bottom:774px;}
#t4e_8{left:500px;bottom:774px;letter-spacing:-0.1px;word-spacing:-1.1px;}
#t4f_8{left:737px;bottom:774px;}
#t4g_8{left:744px;bottom:774px;}
#t4h_8{left:753px;bottom:774px;word-spacing:-1.1px;}
#t4i_8{left:484px;bottom:759px;letter-spacing:-0.1px;word-spacing:5.7px;}
#t4j_8{left:484px;bottom:744px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t4k_8{left:484px;bottom:706px;}
#t4l_8{left:514px;bottom:706px;}
#t4m_8{left:484px;bottom:685px;letter-spacing:-0.2px;word-spacing:10.4px;}
#t4n_8{left:484px;bottom:670px;word-spacing:3.6px;}
#t4o_8{left:484px;bottom:655px;letter-spacing:-0.2px;word-spacing:9.6px;}
#t4p_8{left:484px;bottom:639px;letter-spacing:-0.1px;word-spacing:2.1px;}
#t4q_8{left:484px;bottom:624px;word-spacing:-1.8px;}
#t4r_8{left:484px;bottom:609px;word-spacing:0.1px;}
#t4s_8{left:503px;bottom:594px;letter-spacing:-0.2px;word-spacing:5.1px;}
#t4t_8{left:484px;bottom:578px;}
#t4u_8{left:512px;bottom:578px;}
#t4v_8{left:548px;bottom:578px;letter-spacing:15.1px;}
#t4w_8{left:568px;bottom:578px;}
#t4x_8{left:608px;bottom:578px;word-spacing:1.4px;}
#t4y_8{left:484px;bottom:563px;word-spacing:0.3px;}
#t4z_8{left:484px;bottom:548px;word-spacing:0.9px;}
#t50_8{left:760px;bottom:548px;}
#t51_8{left:807px;bottom:548px;word-spacing:0.9px;}
#t52_8{left:484px;bottom:533px;}
#t53_8{left:503px;bottom:518px;letter-spacing:-0.3px;}
#t54_8{left:562px;bottom:518px;}
#t55_8{left:599px;bottom:518px;letter-spacing:-0.1px;word-spacing:-0.7px;}
#t56_8{left:484px;bottom:502px;letter-spacing:-0.1px;word-spacing:-0.3px;}
#t57_8{left:484px;bottom:487px;letter-spacing:-0.1px;word-spacing:3.2px;}
#t58_8{left:484px;bottom:472px;word-spacing:-1.8px;}
#t59_8{left:635px;bottom:472px;word-spacing:-1.8px;}
#t5a_8{left:703px;bottom:472px;word-spacing:-1.8px;}
#t5b_8{left:484px;bottom:457px;word-spacing:3.7px;}
#t5c_8{left:484px;bottom:441px;letter-spacing:-0.1px;word-spacing:6.2px;}
#t5d_8{left:484px;bottom:426px;word-spacing:2.2px;}
#t5e_8{left:484px;bottom:411px;}
#t5f_8{left:503px;bottom:396px;word-spacing:6.6px;}
#t5g_8{left:484px;bottom:381px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t5h_8{left:503px;bottom:365px;letter-spacing:-0.1px;word-spacing:-1.3px;}
#t5i_8{left:484px;bottom:350px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t5j_8{left:484px;bottom:321px;}
#t5k_8{left:515px;bottom:321px;letter-spacing:-0.2px;word-spacing:0.5px;}
#t5l_8{left:484px;bottom:300px;word-spacing:2.3px;}
#t5m_8{left:661px;bottom:300px;letter-spacing:-0.2px;word-spacing:2.8px;}
#t5n_8{left:725px;bottom:300px;letter-spacing:-0.1px;word-spacing:2.5px;}
#t5o_8{left:484px;bottom:284px;letter-spacing:-0.1px;word-spacing:16.2px;}
#t5p_8{left:484px;bottom:269px;letter-spacing:-0.1px;word-spacing:1.8px;}
#t5q_8{left:484px;bottom:254px;}
#t5r_8{left:545px;bottom:254px;}
#t5s_8{left:503px;bottom:239px;word-spacing:5.7px;}
#t5t_8{left:484px;bottom:224px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t5u_8{left:484px;bottom:208px;word-spacing:8.3px;}
#t5v_8{left:484px;bottom:193px;word-spacing:0.1px;}
#t5w_8{left:503px;bottom:178px;letter-spacing:-0.2px;word-spacing:8.7px;}
#t5x_8{left:484px;bottom:163px;word-spacing:5.5px;}
#t5y_8{left:484px;bottom:147px;letter-spacing:-0.1px;word-spacing:1.2px;}
#t5z_8{left:484px;bottom:132px;word-spacing:0.9px;}
#t60_8{left:484px;bottom:117px;letter-spacing:-0.1px;word-spacing:-0.2px;}
#t61_8{left:484px;bottom:102px;letter-spacing:-0.4px;}

.s1_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

.s2_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s3_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMMI9_2w;
	color: rgb(0,0,0);
}

.s4_8{
	FONT-SIZE: 36.5px;
	FONT-FAMILY: CMR6_r;
	color: rgb(0,0,0);
}

.s5_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMR9_48;
	color: rgb(0,0,0);
}

.s6_8{
	FONT-SIZE: 48.7px;
	FONT-FAMILY: CMSY8_c;
	color: rgb(0,0,0);
}

.s7_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMSY9_l;
	color: rgb(0,0,0);
}

.s8_8{
	FONT-SIZE: 43.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s9_8{
	FONT-SIZE: 36.5px;
	FONT-FAMILY: CMMI6_30;
	color: rgb(0,0,0);
}

.sa_8{
	FONT-SIZE: 67px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

.sb_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMTT9_o;
	color: rgb(0,0,0);
}

.sc_8{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-ReguItal_x;
	color: rgb(0,0,0);
}

</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts8" type="text/css" >

@font-face {
	font-family: CMMI6_30;
	src: url("fonts/CMMI6_30.woff") format("woff");
}

@font-face {
	font-family: CMMI9_2w;
	src: url("fonts/CMMI9_2w.woff") format("woff");
}

@font-face {
	font-family: CMR6_r;
	src: url("fonts/CMR6_r.woff") format("woff");
}

@font-face {
	font-family: CMR9_48;
	src: url("fonts/CMR9_48.woff") format("woff");
}

@font-face {
	font-family: CMSY8_c;
	src: url("fonts/CMSY8_c.woff") format("woff");
}

@font-face {
	font-family: CMSY9_l;
	src: url("fonts/CMSY9_l.woff") format("woff");
}

@font-face {
	font-family: CMTT9_o;
	src: url("fonts/CMTT9_o.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Medi_6;
	src: url("fonts/NimbusRomNo9L-Medi_6.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-ReguItal_x;
	src: url("fonts/NimbusRomNo9L-ReguItal_x.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Regu_9;
	src: url("fonts/NimbusRomNo9L-Regu_9.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg8Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg8" style="-webkit-user-select: none;"><object width="935" height="1210" data="8/8.svg" type="image/svg+xml" id="pdf8" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div id="t1_8" class="t s1_8">5.1</div>
<div id="t2_8" class="t s1_8">Optimizations</div>
<div id="t3_8" class="t s2_8">Because traces are in SSA form and have no join points or</div>
<div id="t4_8" class="t s3_8">φ</div>
<div id="t5_8" class="t s2_8">-</div>
<div id="t6_8" class="t s2_8">nodes, certain optimizations are easy to implement. In order to</div>
<div id="t7_8" class="t s2_8">get good startup performance, the optimizations must run quickly,</div>
<div id="t8_8" class="t s2_8">so we chose a small set of optimizations. We implemented the</div>
<div id="t9_8" class="t s2_8">optimizations as pipelined ﬁlters so that they can be turned on and</div>
<div id="ta_8" class="t s2_8">off independently, and yet all run in just two loop passes over the</div>
<div id="tb_8" class="t s2_8">trace: one forward and one backward.</div>
<div id="tc_8" class="t s2_8">Every time the trace recorder emits a LIR instruction, the in-</div>
<div id="td_8" class="t s2_8">struction is immediately passed to the ﬁrst ﬁlter in the forward</div>
<div id="te_8" class="t s2_8">pipeline. Thus, forward ﬁlter optimizations are performed as the</div>
<div id="tf_8" class="t s2_8">trace is recorded. Each ﬁlter may pass each instruction to the next</div>
<div id="tg_8" class="t s2_8">ﬁlter unchanged, write a different instruction to the next ﬁlter, or</div>
<div id="th_8" class="t s2_8">write no instruction at all. For example, the constant folding ﬁlter</div>
<div id="ti_8" class="t s2_8">can replace a multiply instruction like</div>
<div id="tj_8" class="t s3_8">v</div>
<div id="tk_8" class="t s4_8">13</div>
<div id="tl_8" class="t s5_8">:=</div>
<div id="tm_8" class="t s3_8">mul</div>
<div id="tn_8" class="t s5_8">3</div>
<div id="to_8" class="t s3_8">,</div>
<div id="tp_8" class="t s5_8">1000</div>
<div id="tq_8" class="t s2_8">with a</div>
<div id="tr_8" class="t s2_8">constant instruction</div>
<div id="ts_8" class="t s3_8">v</div>
<div id="tt_8" class="t s4_8">13</div>
<div id="tu_8" class="t s5_8">= 3000</div>
<div id="tv_8" class="t s2_8">.</div>
<div id="tw_8" class="t s2_8">We currently apply four forward ﬁlters:</div>
<div id="tx_8" class="t s6_8">•</div>
<div id="ty_8" class="t s2_8">On ISAs without ﬂoating-point instructions, a soft-ﬂoat ﬁlter</div>
<div id="tz_8" class="t s2_8">converts ﬂoating-point LIR instructions to sequences of integer</div>
<div id="t10_8" class="t s2_8">instructions.</div>
<div id="t11_8" class="t s6_8">•</div>
<div id="t12_8" class="t s2_8">CSE (constant subexpression elimination),</div>
<div id="t13_8" class="t s6_8">•</div>
<div id="t14_8" class="t s2_8">expression simpliﬁcation, including constant folding and a few</div>
<div id="t15_8" class="t s2_8">algebraic identities (e.g.,</div>
<div id="t16_8" class="t s3_8">a</div>
<div id="t17_8" class="t s7_8">-</div>
<div id="t18_8" class="t s3_8">a</div>
<div id="t19_8" class="t s5_8">=0</div>
<div id="t1a_8" class="t s2_8">), and</div>
<div id="t1b_8" class="t s6_8">•</div>
<div id="t1c_8" class="t s2_8">source language semantic-speciﬁc expression simpliﬁcation,</div>
<div id="t1d_8" class="t s2_8">primarily algebraic identities that allow</div>
<div id="t1e_8" class="t s8_8">DOUBLE</div>
<div id="t1f_8" class="t s2_8">to be replaced</div>
<div id="t1g_8" class="t s2_8">with</div>
<div id="t1h_8" class="t s8_8">INT</div>
<div id="t1i_8" class="t s2_8">. For example, LIR that converts an</div>
<div id="t1j_8" class="t s8_8">INT</div>
<div id="t1k_8" class="t s2_8">to a</div>
<div id="t1l_8" class="t s8_8">DOUBLE</div>
<div id="t1m_8" class="t s2_8">and then back again would be removed by this ﬁlter.</div>
<div id="t1n_8" class="t s2_8">When trace recording is completed, nanojit runs the backward</div>
<div id="t1o_8" class="t s2_8">optimization ﬁlters. These are used for optimizations that require</div>
<div id="t1p_8" class="t s2_8">backward program analysis. When running the backward ﬁlters,</div>
<div id="t1q_8" class="t s2_8">nanojit reads one LIR instruction at a time, and the reads are passed</div>
<div id="t1r_8" class="t s2_8">through the pipeline.</div>
<div id="t1s_8" class="t s2_8">We currently apply three backward ﬁlters:</div>
<div id="t1t_8" class="t s6_8">•</div>
<div id="t1u_8" class="t s2_8">Dead data-stack store elimination. The LIR trace encodes many</div>
<div id="t1v_8" class="t s2_8">stores to locations in the interpreter stack. But these values are</div>
<div id="t1w_8" class="t s2_8">never read back before exiting the trace (by the interpreter or</div>
<div id="t1x_8" class="t s2_8">another trace). Thus, stores to the stack that are overwritten</div>
<div id="t1y_8" class="t s2_8">before the next exit are dead. Stores to locations that are off</div>
<div id="t1z_8" class="t s2_8">the top of the interpreter stack at future exits are also dead.</div>
<div id="t20_8" class="t s6_8">•</div>
<div id="t21_8" class="t s2_8">Dead call-stack store elimination. This is the same optimization</div>
<div id="t22_8" class="t s2_8">as above, except applied to the interpreter’s call stack used for</div>
<div id="t23_8" class="t s2_8">function call inlining.</div>
<div id="t24_8" class="t s6_8">•</div>
<div id="t25_8" class="t s2_8">Dead code elimination. This eliminates any operation that</div>
<div id="t26_8" class="t s2_8">stores to a value that is never used.</div>
<div id="t27_8" class="t s2_8">After a LIR instruction is successfully read (“pulled”) from</div>
<div id="t28_8" class="t s2_8">the backward ﬁlter pipeline, nanojit’s code generator emits native</div>
<div id="t29_8" class="t s2_8">machine instruction(s) for it.</div>
<div id="t2a_8" class="t s1_8">5.2</div>
<div id="t2b_8" class="t s1_8">Register Allocation</div>
<div id="t2c_8" class="t s2_8">We use a simple greedy register allocator that makes a single</div>
<div id="t2d_8" class="t s2_8">backward pass over the trace (it is integrated with the code gen-</div>
<div id="t2e_8" class="t s2_8">erator). By the time the allocator has reached an instruction like</div>
<div id="t2f_8" class="t s3_8">v</div>
<div id="t2g_8" class="t s4_8">3</div>
<div id="t2h_8" class="t s5_8">=</div>
<div id="t2i_8" class="t s3_8">add v</div>
<div id="t2j_8" class="t s4_8">1</div>
<div id="t2k_8" class="t s3_8">,v</div>
<div id="t2l_8" class="t s4_8">2</div>
<div id="t2m_8" class="t s2_8">, it has already assigned a register to</div>
<div id="t2n_8" class="t s3_8">v</div>
<div id="t2o_8" class="t s4_8">3</div>
<div id="t2p_8" class="t s2_8">. If</div>
<div id="t2q_8" class="t s3_8">v</div>
<div id="t2r_8" class="t s4_8">1</div>
<div id="t2s_8" class="t s2_8">and</div>
<div id="t2t_8" class="t s3_8">v</div>
<div id="t2u_8" class="t s4_8">2</div>
<div id="t2v_8" class="t s2_8">have not yet been assigned registers, the allocator assigns a free</div>
<div id="t2w_8" class="t s2_8">register to each. If there are no free registers, a value is selected for</div>
<div id="t2x_8" class="t s2_8">spilling. We use a class heuristic that selects the “oldest” register-</div>
<div id="t2y_8" class="t s2_8">carried value (6).</div>
<div id="t2z_8" class="t s2_8">The heuristic considers the set</div>
<div id="t30_8" class="t s3_8">R</div>
<div id="t31_8" class="t s2_8">of values</div>
<div id="t32_8" class="t s3_8">v</div>
<div id="t33_8" class="t s2_8">in registers imme-</div>
<div id="t34_8" class="t s2_8">diately after the current instruction for spilling. Let</div>
<div id="t35_8" class="t s3_8">v</div>
<div id="t36_8" class="t s9_8">m</div>
<div id="t37_8" class="t s2_8">be the last</div>
<div id="t38_8" class="t s2_8">instruction before the current where each</div>
<div id="t39_8" class="t s3_8">v</div>
<div id="t3a_8" class="t s2_8">is referred to. Then the</div>
<div id="t3b_8" class="t s2_8">Tag</div>
<div id="t3c_8" class="t s2_8">JS Type</div>
<div id="t3d_8" class="t s2_8">Description</div>
<div id="t3e_8" class="t s2_8">xx1</div>
<div id="t3f_8" class="t s2_8">number</div>
<div id="t3g_8" class="t s2_8">31-bit integer representation</div>
<div id="t3h_8" class="t s2_8">000</div>
<div id="t3i_8" class="t s2_8">object</div>
<div id="t3j_8" class="t s2_8">pointer to JSObject handle</div>
<div id="t3k_8" class="t s2_8">010</div>
<div id="t3l_8" class="t s2_8">number</div>
<div id="t3m_8" class="t s2_8">pointer to double handle</div>
<div id="t3n_8" class="t s2_8">100</div>
<div id="t3o_8" class="t s2_8">string</div>
<div id="t3p_8" class="t s2_8">pointer to JSString handle</div>
<div id="t3q_8" class="t s2_8">110</div>
<div id="t3r_8" class="t s2_8">boolean</div>
<div id="t3s_8" class="t s2_8">enumeration for null, undeﬁned, true, false</div>
<div id="t3t_8" class="t s2_8">null, or</div>
<div id="t3u_8" class="t s2_8">undeﬁned</div>
<div id="t3v_8" class="t s1_8">Figure 9. Tagged values in the SpiderMonkey JS interpreter.</div>
<div id="t3w_8" class="t s2_8">Testing tags, unboxing (extracting the untagged value) and boxing</div>
<div id="t3x_8" class="t s2_8">(creating tagged values) are signiﬁcant costs. Avoiding these costs</div>
<div id="t3y_8" class="t s2_8">is a key beneﬁt of tracing.</div>
<div id="t3z_8" class="t s2_8">heuristic selects</div>
<div id="t40_8" class="t s3_8">v</div>
<div id="t41_8" class="t s2_8">with minimum</div>
<div id="t42_8" class="t s3_8">v</div>
<div id="t43_8" class="t s9_8">m</div>
<div id="t44_8" class="t s2_8">. The motivation is that this</div>
<div id="t45_8" class="t s2_8">frees up a register for as long as possible given a single spill.</div>
<div id="t46_8" class="t s2_8">If we need to spill a value</div>
<div id="t47_8" class="t s3_8">v</div>
<div id="t48_8" class="t s9_8">s</div>
<div id="t49_8" class="t s2_8">at this point, we generate the</div>
<div id="t4a_8" class="t s2_8">restore code just after the code for the current instruction. The</div>
<div id="t4b_8" class="t s2_8">corresponding spill code is generated just after the last point where</div>
<div id="t4c_8" class="t s3_8">v</div>
<div id="t4d_8" class="t s9_8">s</div>
<div id="t4e_8" class="t s2_8">was used. The register that was assigned to</div>
<div id="t4f_8" class="t s3_8">v</div>
<div id="t4g_8" class="t s9_8">s</div>
<div id="t4h_8" class="t s2_8">is marked free for</div>
<div id="t4i_8" class="t s2_8">the preceding code, because that register can now be used freely</div>
<div id="t4j_8" class="t s2_8">without affecting the following code</div>
<div id="t4k_8" class="t sa_8">6.</div>
<div id="t4l_8" class="t sa_8">Implementation</div>
<div id="t4m_8" class="t s2_8">To demonstrate the effectiveness of our approach, we have im-</div>
<div id="t4n_8" class="t s2_8">plemented a trace-based dynamic compiler for the SpiderMonkey</div>
<div id="t4o_8" class="t s2_8">JavaScript Virtual Machine (4). SpiderMonkey is the JavaScript</div>
<div id="t4p_8" class="t s2_8">VM embedded in Mozilla’s Firefox open-source web browser (2),</div>
<div id="t4q_8" class="t s2_8">which is used by more than 200 million users world-wide. The core</div>
<div id="t4r_8" class="t s2_8">of SpiderMonkey is a bytecode interpreter implemented in C++.</div>
<div id="t4s_8" class="t s2_8">In SpiderMonkey, all JavaScript values are represented by the</div>
<div id="t4t_8" class="t s2_8">type</div>
<div id="t4u_8" class="t sb_8">jsval</div>
<div id="t4v_8" class="t s2_8">.A</div>
<div id="t4w_8" class="t sb_8">jsval</div>
<div id="t4x_8" class="t s2_8">is machine word in which up to the 3 of the</div>
<div id="t4y_8" class="t s2_8">least signiﬁcant bits are a type tag, and the remaining bits are data.</div>
<div id="t4z_8" class="t s2_8">See Figure 6 for details. All pointers contained in</div>
<div id="t50_8" class="t sb_8">jsvals</div>
<div id="t51_8" class="t s2_8">point to</div>
<div id="t52_8" class="t s2_8">GC-controlled blocks aligned on 8-byte boundaries.</div>
<div id="t53_8" class="t s2_8">JavaScript</div>
<div id="t54_8" class="t sc_8">object</div>
<div id="t55_8" class="t s2_8">values are mappings of string-valued property</div>
<div id="t56_8" class="t s2_8">names to arbitrary values. They are represented in one of two ways</div>
<div id="t57_8" class="t s2_8">in SpiderMonkey. Most objects are represented by a shared struc-</div>
<div id="t58_8" class="t s2_8">tural description, called the</div>
<div id="t59_8" class="t sc_8">object shape</div>
<div id="t5a_8" class="t s2_8">, that maps property names</div>
<div id="t5b_8" class="t s2_8">to array indexes using a hash table. The object stores a pointer to</div>
<div id="t5c_8" class="t s2_8">the shape and the array of its own property values. Objects with</div>
<div id="t5d_8" class="t s2_8">large, unique sets of property names store their properties directly</div>
<div id="t5e_8" class="t s2_8">in a hash table.</div>
<div id="t5f_8" class="t s2_8">The garbage collector is an exact, non-generational, stop-the-</div>
<div id="t5g_8" class="t s2_8">world mark-and-sweep collector.</div>
<div id="t5h_8" class="t s2_8">In the rest of this section we discuss key areas of the TraceMon-</div>
<div id="t5i_8" class="t s2_8">key implementation.</div>
<div id="t5j_8" class="t s1_8">6.1</div>
<div id="t5k_8" class="t s1_8">Calling Compiled Traces</div>
<div id="t5l_8" class="t s2_8">Compiled traces are stored in a</div>
<div id="t5m_8" class="t sc_8">trace cache</div>
<div id="t5n_8" class="t s2_8">, indexed by intepreter</div>
<div id="t5o_8" class="t s2_8">PC and type map. Traces are compiled so that they may be</div>
<div id="t5p_8" class="t s2_8">called as functions using standard native calling conventions (e.g.,</div>
<div id="t5q_8" class="t sb_8">FASTCALL</div>
<div id="t5r_8" class="t s2_8">on x86).</div>
<div id="t5s_8" class="t s2_8">The interpreter must hit a loop edge and enter the monitor in</div>
<div id="t5t_8" class="t s2_8">order to call a native trace for the ﬁrst time. The monitor computes</div>
<div id="t5u_8" class="t s2_8">the current type map, checks the trace cache for a trace for the</div>
<div id="t5v_8" class="t s2_8">current PC and type map, and if it ﬁnds one, executes the trace.</div>
<div id="t5w_8" class="t s2_8">To execute a trace, the monitor must build a trace activation</div>
<div id="t5x_8" class="t s2_8">record containing imported local and global variables, temporary</div>
<div id="t5y_8" class="t s2_8">stack space, and space for arguments to native calls. The local and</div>
<div id="t5z_8" class="t s2_8">global values are then copied from the interpreter state to the trace</div>
<div id="t60_8" class="t s2_8">activation record. Then, the trace is called like a normal C function</div>
<div id="t61_8" class="t s2_8">pointer.</div>

<!-- End text definitions -->


</div>
</body>
</html>
