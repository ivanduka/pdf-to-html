<!DOCTYPE html >
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p7" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	-webkit-transform-origin: bottom left;
	-ms-transform-origin: bottom left;
	transform-origin: bottom left;
	-webkit-transform: scale(0.25);
	-ms-transform: scale(0.25);
	transform: scale(0.25);
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_7{left:204px;bottom:1046px;}
#t2_7{left:206px;bottom:1046px;}
#t3_7{left:185px;bottom:1005px;}
#t4_7{left:187px;bottom:1006px;}
#t5_7{left:223px;bottom:1005px;}
#t6_7{left:225px;bottom:1006px;}
#t7_7{left:204px;bottom:972px;}
#t8_7{left:206px;bottom:973px;}
#t9_7{left:204px;bottom:1079px;}
#ta_7{left:206px;bottom:1079px;}
#tb_7{left:157px;bottom:1007px;}
#tc_7{left:158px;bottom:1007px;}
#td_7{left:204px;bottom:939px;}
#te_7{left:206px;bottom:939px;}
#tf_7{left:272px;bottom:1077px;}
#tg_7{left:275px;bottom:1078px;}
#th_7{left:320px;bottom:1010px;}
#ti_7{left:323px;bottom:1011px;}
#tj_7{left:340px;bottom:1064px;letter-spacing:-0.3px;word-spacing:-0.1px;}
#tk_7{left:323px;bottom:1083px;letter-spacing:-0.3px;word-spacing:-0.1px;}
#tl_7{left:341px;bottom:1035px;letter-spacing:-0.3px;word-spacing:-0.1px;}
#tm_7{left:343px;bottom:943px;word-spacing:-0.5px;}
#tn_7{left:201px;bottom:895px;}
#to_7{left:311px;bottom:897px;}
#tp_7{left:83px;bottom:853px;letter-spacing:-0.2px;word-spacing:0.3px;}
#tq_7{left:142px;bottom:853px;}
#tr_7{left:83px;bottom:838px;word-spacing:8.9px;}
#ts_7{left:83px;bottom:822px;word-spacing:-0.5px;}
#tt_7{left:83px;bottom:807px;word-spacing:3px;}
#tu_7{left:83px;bottom:792px;}
#tv_7{left:83px;bottom:748px;word-spacing:-1.3px;}
#tw_7{left:293px;bottom:748px;}
#tx_7{left:301px;bottom:748px;word-spacing:-1.4px;}
#ty_7{left:407px;bottom:748px;}
#tz_7{left:419px;bottom:748px;}
#t10_7{left:83px;bottom:732px;letter-spacing:-0.1px;word-spacing:8.7px;}
#t11_7{left:260px;bottom:732px;letter-spacing:-0.1px;word-spacing:8.6px;}
#t12_7{left:369px;bottom:732px;}
#t13_7{left:380px;bottom:732px;}
#t14_7{left:386px;bottom:732px;}
#t15_7{left:394px;bottom:739px;}
#t16_7{left:401px;bottom:732px;}
#t17_7{left:412px;bottom:732px;}
#t18_7{left:83px;bottom:717px;}
#t19_7{left:101px;bottom:702px;letter-spacing:-0.2px;word-spacing:8.9px;}
#t1a_7{left:83px;bottom:686px;word-spacing:-1.9px;}
#t1b_7{left:83px;bottom:671px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t1c_7{left:83px;bottom:643px;}
#t1d_7{left:113px;bottom:643px;}
#t1e_7{left:83px;bottom:622px;letter-spacing:-0.1px;word-spacing:2.1px;}
#t1f_7{left:83px;bottom:607px;word-spacing:2.7px;}
#t1g_7{left:83px;bottom:591px;word-spacing:-1.1px;}
#t1h_7{left:83px;bottom:576px;word-spacing:-0.5px;}
#t1i_7{left:83px;bottom:561px;letter-spacing:-0.1px;word-spacing:3.8px;}
#t1j_7{left:83px;bottom:546px;letter-spacing:-0.2px;word-spacing:4.2px;}
#t1k_7{left:83px;bottom:531px;word-spacing:9px;}
#t1l_7{left:83px;bottom:515px;word-spacing:1.2px;}
#t1m_7{left:83px;bottom:500px;letter-spacing:-0.2px;word-spacing:-1.5px;}
#t1n_7{left:83px;bottom:485px;}
#t1o_7{left:118px;bottom:485px;}
#t1p_7{left:142px;bottom:485px;letter-spacing:-0.2px;word-spacing:0.3px;}
#t1q_7{left:101px;bottom:470px;letter-spacing:-0.2px;word-spacing:3px;}
#t1r_7{left:83px;bottom:454px;word-spacing:1.5px;}
#t1s_7{left:83px;bottom:439px;word-spacing:7.5px;}
#t1t_7{left:83px;bottom:424px;letter-spacing:-0.1px;word-spacing:9.2px;}
#t1u_7{left:83px;bottom:409px;word-spacing:7.8px;}
#t1v_7{left:83px;bottom:394px;word-spacing:2.6px;}
#t1w_7{left:131px;bottom:394px;}
#t1x_7{left:141px;bottom:393px;}
#t1y_7{left:154px;bottom:394px;}
#t1z_7{left:158px;bottom:394px;}
#t20_7{left:173px;bottom:394px;word-spacing:2.6px;}
#t21_7{left:83px;bottom:378px;letter-spacing:-0.1px;word-spacing:-0.2px;}
#t22_7{left:184px;bottom:378px;}
#t23_7{left:194px;bottom:378px;}
#t24_7{left:207px;bottom:378px;}
#t25_7{left:211px;bottom:378px;}
#t26_7{left:226px;bottom:378px;word-spacing:-0.4px;}
#t27_7{left:366px;bottom:378px;}
#t28_7{left:376px;bottom:378px;}
#t29_7{left:389px;bottom:378px;word-spacing:-0.4px;}
#t2a_7{left:83px;bottom:363px;}
#t2b_7{left:157px;bottom:363px;}
#t2c_7{left:166px;bottom:363px;}
#t2d_7{left:179px;bottom:363px;word-spacing:0.1px;}
#t2e_7{left:90px;bottom:342px;}
#t2f_7{left:102px;bottom:340px;}
#t2g_7{left:116px;bottom:340px;}
#t2h_7{left:125px;bottom:339px;}
#t2i_7{left:139px;bottom:340px;word-spacing:3px;}
#t2j_7{left:413px;bottom:340px;}
#t2k_7{left:423px;bottom:339px;}
#t2l_7{left:436px;bottom:340px;}
#t2m_7{left:102px;bottom:325px;word-spacing:1.3px;}
#t2n_7{left:102px;bottom:310px;word-spacing:0.6px;}
#t2o_7{left:187px;bottom:310px;}
#t2p_7{left:196px;bottom:309px;}
#t2q_7{left:205px;bottom:310px;letter-spacing:-0.1px;word-spacing:0.7px;}
#t2r_7{left:404px;bottom:310px;}
#t2s_7{left:414px;bottom:309px;}
#t2t_7{left:426px;bottom:310px;}
#t2u_7{left:102px;bottom:294px;letter-spacing:-0.2px;word-spacing:0.3px;}
#t2v_7{left:90px;bottom:275px;}
#t2w_7{left:102px;bottom:273px;}
#t2x_7{left:116px;bottom:273px;}
#t2y_7{left:126px;bottom:272px;}
#t2z_7{left:140px;bottom:273px;letter-spacing:-0.1px;word-spacing:4.7px;}
#t30_7{left:102px;bottom:258px;letter-spacing:-0.1px;word-spacing:7.5px;}
#t31_7{left:102px;bottom:243px;word-spacing:3.8px;}
#t32_7{left:102px;bottom:227px;letter-spacing:-0.1px;word-spacing:6.5px;}
#t33_7{left:102px;bottom:212px;}
#t34_7{left:268px;bottom:218px;}
#t35_7{left:101px;bottom:188px;word-spacing:-2.6px;}
#t36_7{left:83px;bottom:173px;word-spacing:-2.4px;}
#t37_7{left:386px;bottom:173px;}
#t38_7{left:394px;bottom:173px;word-spacing:-2.4px;}
#t39_7{left:83px;bottom:148px;}
#t3a_7{left:89px;bottom:143px;word-spacing:2px;}
#t3b_7{left:83px;bottom:130px;word-spacing:4.6px;}
#t3c_7{left:83px;bottom:116px;letter-spacing:-0.1px;word-spacing:4.2px;}
#t3d_7{left:83px;bottom:102px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t3e_7{left:609px;bottom:1048px;}
#t3f_7{left:611px;bottom:1048px;}
#t3g_7{left:609px;bottom:1018px;}
#t3h_7{left:611px;bottom:1018px;}
#t3i_7{left:609px;bottom:1080px;}
#t3j_7{left:611px;bottom:1081px;}
#t3k_7{left:609px;bottom:927px;}
#t3l_7{left:611px;bottom:927px;}
#t3m_7{left:609px;bottom:985px;}
#t3n_7{left:611px;bottom:986px;}
#t3o_7{left:609px;bottom:955px;}
#t3p_7{left:611px;bottom:956px;}
#t3q_7{left:684px;bottom:1048px;}
#t3r_7{left:686px;bottom:1049px;}
#t3s_7{left:657px;bottom:1082px;}
#t3t_7{left:660px;bottom:1083px;}
#t3u_7{left:684px;bottom:982px;}
#t3v_7{left:686px;bottom:983px;}
#t3w_7{left:708px;bottom:995px;word-spacing:-0.5px;}
#t3x_7{left:702px;bottom:1072px;letter-spacing:-0.3px;word-spacing:-0.1px;}
#t3y_7{left:484px;bottom:881px;letter-spacing:-0.2px;word-spacing:-1px;}
#t3z_7{left:543px;bottom:881px;letter-spacing:-0.1px;word-spacing:-1.3px;}
#t40_7{left:484px;bottom:866px;word-spacing:3.8px;}
#t41_7{left:484px;bottom:851px;word-spacing:1.2px;}
#t42_7{left:484px;bottom:836px;}
#t43_7{left:484px;bottom:785px;word-spacing:-0.8px;}
#t44_7{left:595px;bottom:785px;}
#t45_7{left:611px;bottom:785px;letter-spacing:-0.1px;word-spacing:-0.6px;}
#t46_7{left:484px;bottom:769px;word-spacing:2.1px;}
#t47_7{left:580px;bottom:769px;}
#t48_7{left:591px;bottom:769px;}
#t49_7{left:596px;bottom:769px;}
#t4a_7{left:609px;bottom:776px;}
#t4b_7{left:616px;bottom:769px;}
#t4c_7{left:625px;bottom:769px;word-spacing:2.1px;}
#t4d_7{left:484px;bottom:754px;}
#t4e_7{left:500px;bottom:754px;}
#t4f_7{left:503px;bottom:738px;word-spacing:-2.9px;}
#t4g_7{left:484px;bottom:723px;letter-spacing:-0.1px;word-spacing:-0.6px;}
#t4h_7{left:484px;bottom:708px;word-spacing:2.2px;}
#t4i_7{left:484px;bottom:693px;word-spacing:6px;}
#t4j_7{left:484px;bottom:678px;letter-spacing:-0.1px;word-spacing:4.3px;}
#t4k_7{left:484px;bottom:662px;letter-spacing:-0.1px;word-spacing:3.7px;}
#t4l_7{left:484px;bottom:647px;word-spacing:7.5px;}
#t4m_7{left:484px;bottom:632px;word-spacing:9.5px;}
#t4n_7{left:484px;bottom:617px;letter-spacing:-0.1px;word-spacing:8.4px;}
#t4o_7{left:484px;bottom:601px;word-spacing:5.6px;}
#t4p_7{left:484px;bottom:586px;word-spacing:3.9px;}
#t4q_7{left:484px;bottom:571px;word-spacing:3.5px;}
#t4r_7{left:484px;bottom:556px;letter-spacing:-0.1px;word-spacing:0.6px;}
#t4s_7{left:484px;bottom:541px;}
#t4t_7{left:484px;bottom:525px;letter-spacing:-0.1px;word-spacing:-0.8px;}
#t4u_7{left:484px;bottom:510px;word-spacing:3.6px;}
#t4v_7{left:484px;bottom:495px;word-spacing:0.1px;}
#t4w_7{left:484px;bottom:462px;}
#t4x_7{left:515px;bottom:462px;}
#t4y_7{left:484px;bottom:441px;word-spacing:6.2px;}
#t4z_7{left:484px;bottom:425px;word-spacing:6px;}
#t50_7{left:484px;bottom:410px;letter-spacing:-0.1px;word-spacing:0.9px;}
#t51_7{left:484px;bottom:395px;word-spacing:6.2px;}
#t52_7{left:484px;bottom:380px;}
#t53_7{left:503px;bottom:364px;letter-spacing:-0.1px;word-spacing:2px;}
#t54_7{left:484px;bottom:349px;letter-spacing:-0.1px;word-spacing:2.9px;}
#t55_7{left:484px;bottom:334px;word-spacing:1.7px;}
#t56_7{left:484px;bottom:319px;word-spacing:0.1px;}
#t57_7{left:503px;bottom:304px;word-spacing:4.1px;}
#t58_7{left:484px;bottom:288px;letter-spacing:-0.1px;word-spacing:5.8px;}
#t59_7{left:484px;bottom:273px;word-spacing:3.5px;}
#t5a_7{left:484px;bottom:258px;letter-spacing:-0.1px;word-spacing:3.4px;}
#t5b_7{left:484px;bottom:243px;letter-spacing:-0.2px;word-spacing:-1.2px;}
#t5c_7{left:484px;bottom:227px;word-spacing:-0.3px;}
#t5d_7{left:484px;bottom:212px;}
#t5e_7{left:484px;bottom:168px;}
#t5f_7{left:514px;bottom:168px;letter-spacing:-0.6px;word-spacing:1.2px;}
#t5g_7{left:484px;bottom:147px;letter-spacing:-0.1px;word-spacing:13.1px;}
#t5h_7{left:484px;bottom:132px;word-spacing:5.9px;}
#t5i_7{left:485px;bottom:118px;letter-spacing:2.5px;}
#t5j_7{left:535px;bottom:117px;word-spacing:12.1px;}
#t5k_7{left:484px;bottom:102px;}

.s1_7{
	FONT-SIZE: 29.9px;
	FONT-FAMILY: XMYAFE-2BCalibri-Bold_4d;
	color: rgb(0,0,0);
}

.s2_7{
	FONT-SIZE: 21.4px;
	FONT-FAMILY: XMYAFE-2BCalibri-Bold_4d;
	color: rgb(0,0,0);
}

.s3_7{
	FONT-SIZE: 25.7px;
	FONT-FAMILY: XMYAFE-2BCalibri-Bold_4d;
	color: rgb(0,0,0);
}

.s4_7{
	FONT-SIZE: 38.5px;
	FONT-FAMILY: XMYAFE-2BCalibri-Bold_4d;
	color: rgb(0,0,0);
}

.s5_7{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

.s6_7{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s7_7{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMMI9_2w;
	color: rgb(0,0,0);
}

.s8_7{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMR9_48;
	color: rgb(0,0,0);
}

.s9_7{
	FONT-SIZE: 36.5px;
	FONT-FAMILY: CMMI6_30;
	color: rgb(0,0,0);
}

.sa_7{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-ReguItal_x;
	color: rgb(0,0,0);
}

.sb_7{
	FONT-SIZE: 48.7px;
	FONT-FAMILY: CMSY8_c;
	color: rgb(0,0,0);
}

.sc_7{
	FONT-SIZE: 36.5px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.sd_7{
	FONT-SIZE: 48.7px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.se_7{
	FONT-SIZE: 28.2px;
	FONT-FAMILY: BLSTWU-2BCalibri-Bold_4s;
	color: rgb(0,0,0);
}

.sf_7{
	FONT-SIZE: 20.2px;
	FONT-FAMILY: BLSTWU-2BCalibri-Bold_4s;
	color: rgb(0,0,0);
}

.sg_7{
	FONT-SIZE: 24.2px;
	FONT-FAMILY: BLSTWU-2BCalibri-Bold_4s;
	color: rgb(0,0,0);
}

.sh_7{
	FONT-SIZE: 67px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

.si_7{
	FONT-SIZE: 43.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts7" type="text/css" >

@font-face {
	font-family: BLSTWU-2BCalibri-Bold_4s;
	src: url("fonts/BLSTWU-2BCalibri-Bold_4s.woff") format("woff");
}

@font-face {
	font-family: CMMI6_30;
	src: url("fonts/CMMI6_30.woff") format("woff");
}

@font-face {
	font-family: CMMI9_2w;
	src: url("fonts/CMMI9_2w.woff") format("woff");
}

@font-face {
	font-family: CMR9_48;
	src: url("fonts/CMR9_48.woff") format("woff");
}

@font-face {
	font-family: CMSY8_c;
	src: url("fonts/CMSY8_c.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Medi_6;
	src: url("fonts/NimbusRomNo9L-Medi_6.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-ReguItal_x;
	src: url("fonts/NimbusRomNo9L-ReguItal_x.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Regu_9;
	src: url("fonts/NimbusRomNo9L-Regu_9.woff") format("woff");
}

@font-face {
	font-family: XMYAFE-2BCalibri-Bold_4d;
	src: url("fonts/XMYAFE-2BCalibri-Bold_4d.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg7Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg7" style="-webkit-user-select: none;"><object width="935" height="1210" data="7/7.svg" type="image/svg+xml" id="pdf7" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div id="t1_7" class="t s1_7">i</div>
<div id="t2_7" class="t s2_7">2</div>
<div id="t3_7" class="t s1_7">i</div>
<div id="t4_7" class="t s2_7">3</div>
<div id="t5_7" class="t s1_7">i</div>
<div id="t6_7" class="t s2_7">4</div>
<div id="t7_7" class="t s1_7">i</div>
<div id="t8_7" class="t s2_7">5</div>
<div id="t9_7" class="t s1_7">i</div>
<div id="ta_7" class="t s2_7">1</div>
<div id="tb_7" class="t s1_7">i</div>
<div id="tc_7" class="t s2_7">6</div>
<div id="td_7" class="t s1_7">i</div>
<div id="te_7" class="t s2_7">7</div>
<div id="tf_7" class="t s1_7">t</div>
<div id="tg_7" class="t s2_7">1</div>
<div id="th_7" class="t s1_7">t</div>
<div id="ti_7" class="t s2_7">2</div>
<div id="tj_7" class="t s3_7">Tree Call</div>
<div id="tk_7" class="t s3_7">Outer Tree</div>
<div id="tl_7" class="t s3_7">Nested Tree</div>
<div id="tm_7" class="t s3_7">Exit Guard</div>
<div id="tn_7" class="t s4_7">(a)</div>
<div id="to_7" class="t s4_7">(b)</div>
<div id="tp_7" class="t s5_7">Figure 7.</div>
<div id="tq_7" class="t s6_7">Control ﬂow graph of a nested loop with an if statement</div>
<div id="tr_7" class="t s6_7">inside the inner most loop (a). An inner tree captures the inner</div>
<div id="ts_7" class="t s6_7">loop, and is nested inside an outer tree which “calls” the inner tree.</div>
<div id="tt_7" class="t s6_7">The inner tree returns to the outer tree once it exits along its loop</div>
<div id="tu_7" class="t s6_7">condition guard (b).</div>
<div id="tv_7" class="t s6_7">In general, if loops are nested to depth</div>
<div id="tw_7" class="t s7_7">k</div>
<div id="tx_7" class="t s6_7">, and each loop has</div>
<div id="ty_7" class="t s7_7">n</div>
<div id="tz_7" class="t s6_7">paths</div>
<div id="t10_7" class="t s6_7">(on geometric average), this na¨</div>
<div id="t11_7" class="t s6_7">ıve strategy yields</div>
<div id="t12_7" class="t s7_7">O</div>
<div id="t13_7" class="t s8_7">(</div>
<div id="t14_7" class="t s7_7">n</div>
<div id="t15_7" class="t s9_7">k</div>
<div id="t16_7" class="t s8_7">)</div>
<div id="t17_7" class="t s6_7">traces,</div>
<div id="t18_7" class="t s6_7">which can easily ﬁll the trace cache.</div>
<div id="t19_7" class="t s6_7">In order to execute programs with nested loops efﬁciently, a</div>
<div id="t1a_7" class="t s6_7">tracing system needs a technique for covering the nested loops with</div>
<div id="t1b_7" class="t s6_7">native code without exponential trace duplication.</div>
<div id="t1c_7" class="t s5_7">4.1</div>
<div id="t1d_7" class="t s5_7">Nesting Algorithm</div>
<div id="t1e_7" class="t s6_7">The key insight is that if each loop is represented by its own trace</div>
<div id="t1f_7" class="t s6_7">tree, the code for each loop can be contained only in its own tree,</div>
<div id="t1g_7" class="t s6_7">and outer loop paths will not be duplicated. Another key fact is that</div>
<div id="t1h_7" class="t s6_7">we are not tracing arbitrary bytecodes that might have irreduceable</div>
<div id="t1i_7" class="t s6_7">control ﬂow graphs, but rather bytecodes produced by a compiler</div>
<div id="t1j_7" class="t s6_7">for a language with structured control ﬂow. Thus, given two loop</div>
<div id="t1k_7" class="t s6_7">edges, the system can easily determine whether they are nested</div>
<div id="t1l_7" class="t s6_7">and which is the inner loop. Using this knowledge, the system can</div>
<div id="t1m_7" class="t s6_7">compile inner and outer loops separately, and make the outer loop’s</div>
<div id="t1n_7" class="t s6_7">traces</div>
<div id="t1o_7" class="t sa_7">call</div>
<div id="t1p_7" class="t s6_7">the inner loop’s trace tree.</div>
<div id="t1q_7" class="t s6_7">The algorithm for building nested trace trees is as follows. We</div>
<div id="t1r_7" class="t s6_7">start tracing at loop headers exactly as in the basic tracing system.</div>
<div id="t1s_7" class="t s6_7">When we exit a loop (detected by comparing the interpreter PC</div>
<div id="t1t_7" class="t s6_7">with the range given by the loop edge), we stop the trace. The</div>
<div id="t1u_7" class="t s6_7">key step of the algorithm occurs when we are recording a trace</div>
<div id="t1v_7" class="t s6_7">for loop</div>
<div id="t1w_7" class="t s7_7">L</div>
<div id="t1x_7" class="t s9_7">R</div>
<div id="t1y_7" class="t s6_7">(</div>
<div id="t1z_7" class="t s7_7">R</div>
<div id="t20_7" class="t s6_7">for loop being recorded) and we reach the header</div>
<div id="t21_7" class="t s6_7">of a different loop</div>
<div id="t22_7" class="t s7_7">L</div>
<div id="t23_7" class="t s9_7">O</div>
<div id="t24_7" class="t s6_7">(</div>
<div id="t25_7" class="t s7_7">O</div>
<div id="t26_7" class="t s6_7">for other loop). Note that</div>
<div id="t27_7" class="t s7_7">L</div>
<div id="t28_7" class="t s9_7">O</div>
<div id="t29_7" class="t s6_7">must be an</div>
<div id="t2a_7" class="t s6_7">inner loop of</div>
<div id="t2b_7" class="t s7_7">L</div>
<div id="t2c_7" class="t s9_7">R</div>
<div id="t2d_7" class="t s6_7">because we stop the trace when we exit a loop.</div>
<div id="t2e_7" class="t sb_7">•</div>
<div id="t2f_7" class="t s6_7">If</div>
<div id="t2g_7" class="t s7_7">L</div>
<div id="t2h_7" class="t s9_7">O</div>
<div id="t2i_7" class="t s6_7">has a type-matching compiled trace tree, we call</div>
<div id="t2j_7" class="t s7_7">L</div>
<div id="t2k_7" class="t s9_7">O</div>
<div id="t2l_7" class="t s6_7">as</div>
<div id="t2m_7" class="t s6_7">a nested trace tree. If the call succeeds, then we record the call</div>
<div id="t2n_7" class="t s6_7">in the trace for</div>
<div id="t2o_7" class="t s7_7">L</div>
<div id="t2p_7" class="t s9_7">R</div>
<div id="t2q_7" class="t s6_7">. On future executions, the trace for</div>
<div id="t2r_7" class="t s7_7">L</div>
<div id="t2s_7" class="t s9_7">R</div>
<div id="t2t_7" class="t s6_7">will</div>
<div id="t2u_7" class="t s6_7">call the inner trace directly.</div>
<div id="t2v_7" class="t sb_7">•</div>
<div id="t2w_7" class="t s6_7">If</div>
<div id="t2x_7" class="t s7_7">L</div>
<div id="t2y_7" class="t s9_7">O</div>
<div id="t2z_7" class="t s6_7">does not have a type-matching compiled trace tree yet,</div>
<div id="t30_7" class="t s6_7">we have to obtain it before we are able to proceed. In order</div>
<div id="t31_7" class="t s6_7">to do this, we simply abort recording the ﬁrst trace. The trace</div>
<div id="t32_7" class="t s6_7">monitor will see the inner loop header, and will immediately</div>
<div id="t33_7" class="t s6_7">start recording the inner loop.</div>
<div id="t34_7" class="t sc_7">2</div>
<div id="t35_7" class="t s6_7">If all the loops in a nest are type-stable, then loop nesting creates</div>
<div id="t36_7" class="t s6_7">no duplication. Otherwise, if loops are nested to a depth</div>
<div id="t37_7" class="t s7_7">k</div>
<div id="t38_7" class="t s6_7">, and each</div>
<div id="t39_7" class="t sc_7">2</div>
<div id="t3a_7" class="t sd_7">Instead of aborting the outer recording, we could principally merely sus-</div>
<div id="t3b_7" class="t sd_7">pend the recording, but that would require the implementation to be able</div>
<div id="t3c_7" class="t sd_7">to record several traces simultaneously, complicating the implementation,</div>
<div id="t3d_7" class="t sd_7">while saving only a few iterations in the interpreter.</div>
<div id="t3e_7" class="t se_7">i</div>
<div id="t3f_7" class="t sf_7">2</div>
<div id="t3g_7" class="t se_7">i</div>
<div id="t3h_7" class="t sf_7">3</div>
<div id="t3i_7" class="t se_7">i</div>
<div id="t3j_7" class="t sf_7">1</div>
<div id="t3k_7" class="t se_7">i</div>
<div id="t3l_7" class="t sf_7">6</div>
<div id="t3m_7" class="t se_7">i</div>
<div id="t3n_7" class="t sf_7">4</div>
<div id="t3o_7" class="t se_7">i</div>
<div id="t3p_7" class="t sf_7">5</div>
<div id="t3q_7" class="t se_7">t</div>
<div id="t3r_7" class="t sf_7">2</div>
<div id="t3s_7" class="t se_7">t</div>
<div id="t3t_7" class="t sf_7">1</div>
<div id="t3u_7" class="t se_7">t</div>
<div id="t3v_7" class="t sf_7">4</div>
<div id="t3w_7" class="t sg_7">Exit Guard</div>
<div id="t3x_7" class="t sg_7">Nested Tree</div>
<div id="t3y_7" class="t s5_7">Figure 8.</div>
<div id="t3z_7" class="t s6_7">Control ﬂow graph of a loop with two nested loops (left)</div>
<div id="t40_7" class="t s6_7">and its nested trace tree conﬁguration (right). The outer tree calls</div>
<div id="t41_7" class="t s6_7">the two inner nested trace trees and places guards at their side exit</div>
<div id="t42_7" class="t s6_7">locations.</div>
<div id="t43_7" class="t s6_7">loop is entered with</div>
<div id="t44_7" class="t s7_7">m</div>
<div id="t45_7" class="t s6_7">different type maps (on geometric average),</div>
<div id="t46_7" class="t s6_7">then we compile</div>
<div id="t47_7" class="t s7_7">O</div>
<div id="t48_7" class="t s8_7">(</div>
<div id="t49_7" class="t s7_7">m</div>
<div id="t4a_7" class="t s9_7">k</div>
<div id="t4b_7" class="t s8_7">)</div>
<div id="t4c_7" class="t s6_7">copies of the innermost loop. As long as</div>
<div id="t4d_7" class="t s7_7">m</div>
<div id="t4e_7" class="t s6_7">is close to 1, the resulting trace trees will be tractable.</div>
<div id="t4f_7" class="t s6_7">An important detail is that the call to the inner trace tree must act</div>
<div id="t4g_7" class="t s6_7">like a function call site: it must return to the same point every time.</div>
<div id="t4h_7" class="t s6_7">The goal of nesting is to make inner and outer loops independent;</div>
<div id="t4i_7" class="t s6_7">thus when the inner tree is called, it must exit to the same point</div>
<div id="t4j_7" class="t s6_7">in the outer tree every time with the same type map. Because we</div>
<div id="t4k_7" class="t s6_7">cannot actually guarantee this property, we must guard on it after</div>
<div id="t4l_7" class="t s6_7">the call, and side exit if the property does not hold. A common</div>
<div id="t4m_7" class="t s6_7">reason for the inner tree not to return to the same point would</div>
<div id="t4n_7" class="t s6_7">be if the inner tree took a new side exit for which it had never</div>
<div id="t4o_7" class="t s6_7">compiled a trace. At this point, the interpreter PC is in the inner</div>
<div id="t4p_7" class="t s6_7">tree, so we cannot continue recording or executing the outer tree.</div>
<div id="t4q_7" class="t s6_7">If this happens during recording, we abort the outer trace, to give</div>
<div id="t4r_7" class="t s6_7">the inner tree a chance to ﬁnish growing. A future execution of the</div>
<div id="t4s_7" class="t s6_7">outer tree would then be able to properly ﬁnish and record a call to</div>
<div id="t4t_7" class="t s6_7">the inner tree. If an inner tree side exit happens during execution of</div>
<div id="t4u_7" class="t s6_7">a compiled trace for the outer tree, we simply exit the outer trace</div>
<div id="t4v_7" class="t s6_7">and start recording a new branch in the inner tree.</div>
<div id="t4w_7" class="t s5_7">4.2</div>
<div id="t4x_7" class="t s5_7">Blacklisting with Nesting</div>
<div id="t4y_7" class="t s6_7">The blacklisting algorithm needs modiﬁcation to work well with</div>
<div id="t4z_7" class="t s6_7">nesting. The problem is that outer loop traces often abort during</div>
<div id="t50_7" class="t s6_7">startup (because the inner tree is not available or takes a side exit),</div>
<div id="t51_7" class="t s6_7">which would lead to their being quickly blacklisted by the basic</div>
<div id="t52_7" class="t s6_7">algorithm.</div>
<div id="t53_7" class="t s6_7">The key observation is that when an outer trace aborts because</div>
<div id="t54_7" class="t s6_7">the inner tree is not ready, this is probably a temporary condition.</div>
<div id="t55_7" class="t s6_7">Thus, we should not count such aborts toward blacklisting as long</div>
<div id="t56_7" class="t s6_7">as we are able to build up more traces for the inner tree.</div>
<div id="t57_7" class="t s6_7">In our implementation, when an outer tree aborts on the inner</div>
<div id="t58_7" class="t s6_7">tree, we increment the outer tree’s blacklist counter as usual and</div>
<div id="t59_7" class="t s6_7">back off on compiling it. When the inner tree ﬁnishes a trace, we</div>
<div id="t5a_7" class="t s6_7">decrement the blacklist counter on the outer loop, “forgiving” the</div>
<div id="t5b_7" class="t s6_7">outer loop for aborting previously. We also undo the backoff so that</div>
<div id="t5c_7" class="t s6_7">the outer tree can start immediately trying to compile the next time</div>
<div id="t5d_7" class="t s6_7">we reach it.</div>
<div id="t5e_7" class="t sh_7">5.</div>
<div id="t5f_7" class="t sh_7">Trace Tree Optimization</div>
<div id="t5g_7" class="t s6_7">This section explains how a recorded trace is translated to an</div>
<div id="t5h_7" class="t s6_7">optimized machine code trace. The trace compilation subsystem,</div>
<div id="t5i_7" class="t si_7">NANOJIT</div>
<div id="t5j_7" class="t s6_7">, is separate from the VM and can be used for other</div>
<div id="t5k_7" class="t s6_7">applications.</div>

<!-- End text definitions -->


</div>
</body>
</html>
