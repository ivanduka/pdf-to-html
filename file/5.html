<!DOCTYPE html >
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p5" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	-webkit-transform-origin: bottom left;
	-ms-transform-origin: bottom left;
	transform-origin: bottom left;
	-webkit-transform: scale(0.25);
	-ms-transform: scale(0.25);
	transform: scale(0.25);
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_5{left:83px;bottom:1085px;letter-spacing:-0.1px;word-spacing:7.5px;}
#t2_5{left:374px;bottom:1085px;word-spacing:7.4px;}
#t3_5{left:444px;bottom:1085px;}
#t4_5{left:83px;bottom:1070px;}
#t5_5{left:101px;bottom:1055px;word-spacing:11.1px;}
#t6_5{left:347px;bottom:1055px;letter-spacing:-0.2px;word-spacing:11.5px;}
#t7_5{left:83px;bottom:1039px;word-spacing:6.9px;}
#t8_5{left:83px;bottom:1024px;letter-spacing:-0.1px;word-spacing:12.1px;}
#t9_5{left:83px;bottom:1009px;word-spacing:0.4px;}
#ta_5{left:83px;bottom:994px;letter-spacing:-0.2px;word-spacing:2.9px;}
#tb_5{left:83px;bottom:978px;letter-spacing:-0.1px;word-spacing:7px;}
#tc_5{left:383px;bottom:985px;}
#td_5{left:394px;bottom:978px;letter-spacing:-0.5px;word-spacing:7.8px;}
#te_5{left:83px;bottom:963px;letter-spacing:-0.1px;word-spacing:1.8px;}
#tf_5{left:83px;bottom:948px;letter-spacing:-0.2px;word-spacing:0.3px;}
#tg_5{left:101px;bottom:932px;letter-spacing:-0.2px;word-spacing:3.6px;}
#th_5{left:83px;bottom:917px;word-spacing:5.6px;}
#ti_5{left:83px;bottom:902px;word-spacing:-1.4px;}
#tj_5{left:83px;bottom:887px;word-spacing:2.3px;}
#tk_5{left:83px;bottom:871px;word-spacing:6.6px;}
#tl_5{left:83px;bottom:856px;letter-spacing:-0.1px;word-spacing:2.5px;}
#tm_5{left:83px;bottom:841px;letter-spacing:-0.1px;word-spacing:0.1px;}
#tn_5{left:101px;bottom:826px;letter-spacing:-0.1px;word-spacing:8.9px;}
#to_5{left:213px;bottom:826px;word-spacing:8.8px;}
#tp_5{left:83px;bottom:811px;letter-spacing:-0.1px;word-spacing:4.3px;}
#tq_5{left:83px;bottom:795px;letter-spacing:-0.1px;word-spacing:2.4px;}
#tr_5{left:83px;bottom:780px;letter-spacing:-0.1px;word-spacing:-1.2px;}
#ts_5{left:83px;bottom:765px;letter-spacing:-0.1px;word-spacing:3.1px;}
#tt_5{left:83px;bottom:750px;letter-spacing:-0.1px;word-spacing:9.5px;}
#tu_5{left:83px;bottom:734px;word-spacing:7.4px;}
#tv_5{left:83px;bottom:719px;letter-spacing:-0.1px;word-spacing:11.9px;}
#tw_5{left:83px;bottom:704px;word-spacing:4px;}
#tx_5{left:83px;bottom:689px;letter-spacing:-0.1px;word-spacing:6.3px;}
#ty_5{left:83px;bottom:674px;letter-spacing:-0.1px;word-spacing:3.8px;}
#tz_5{left:83px;bottom:658px;word-spacing:2.8px;}
#t10_5{left:83px;bottom:643px;}
#t11_5{left:101px;bottom:628px;word-spacing:12.9px;}
#t12_5{left:246px;bottom:628px;letter-spacing:-0.1px;word-spacing:13px;}
#t13_5{left:83px;bottom:613px;word-spacing:9.3px;}
#t14_5{left:83px;bottom:597px;word-spacing:0.6px;}
#t15_5{left:83px;bottom:582px;word-spacing:7.4px;}
#t16_5{left:83px;bottom:567px;letter-spacing:-0.2px;word-spacing:7.1px;}
#t17_5{left:129px;bottom:567px;word-spacing:6.8px;}
#t18_5{left:83px;bottom:552px;word-spacing:9.1px;}
#t19_5{left:83px;bottom:537px;word-spacing:-0.5px;}
#t1a_5{left:83px;bottom:521px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t1b_5{left:101px;bottom:506px;}
#t1c_5{left:149px;bottom:506px;word-spacing:5.5px;}
#t1d_5{left:83px;bottom:491px;letter-spacing:-0.2px;word-spacing:7.3px;}
#t1e_5{left:161px;bottom:491px;}
#t1f_5{left:195px;bottom:491px;word-spacing:6.9px;}
#t1g_5{left:83px;bottom:476px;word-spacing:9.8px;}
#t1h_5{left:83px;bottom:460px;word-spacing:5.2px;}
#t1i_5{left:83px;bottom:445px;letter-spacing:-0.1px;word-spacing:1.3px;}
#t1j_5{left:83px;bottom:430px;word-spacing:1.2px;}
#t1k_5{left:83px;bottom:415px;letter-spacing:-0.1px;word-spacing:3.6px;}
#t1l_5{left:83px;bottom:400px;word-spacing:-2.1px;}
#t1m_5{left:341px;bottom:400px;}
#t1n_5{left:379px;bottom:400px;word-spacing:-2.1px;}
#t1o_5{left:83px;bottom:384px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t1p_5{left:83px;bottom:347px;}
#t1q_5{left:113px;bottom:347px;letter-spacing:-1.1px;word-spacing:2.3px;}
#t1r_5{left:83px;bottom:326px;letter-spacing:-0.1px;word-spacing:7.2px;}
#t1s_5{left:83px;bottom:310px;letter-spacing:-0.1px;word-spacing:-0.1px;}
#t1t_5{left:83px;bottom:295px;word-spacing:3.4px;}
#t1u_5{left:83px;bottom:280px;letter-spacing:-0.1px;word-spacing:6.2px;}
#t1v_5{left:83px;bottom:265px;letter-spacing:-0.1px;word-spacing:5.2px;}
#t1w_5{left:83px;bottom:250px;letter-spacing:-0.7px;}
#t1x_5{left:109px;bottom:250px;letter-spacing:-0.3px;word-spacing:0.9px;}
#t1y_5{left:182px;bottom:250px;word-spacing:0.5px;}
#t1z_5{left:83px;bottom:234px;letter-spacing:-0.1px;word-spacing:-0.6px;}
#t20_5{left:83px;bottom:219px;letter-spacing:-0.2px;word-spacing:0.4px;}
#t21_5{left:251px;bottom:219px;letter-spacing:-0.4px;word-spacing:0.8px;}
#t22_5{left:304px;bottom:219px;}
#t23_5{left:101px;bottom:204px;letter-spacing:-0.1px;word-spacing:1.8px;}
#t24_5{left:83px;bottom:189px;letter-spacing:-0.1px;word-spacing:1.1px;}
#t25_5{left:83px;bottom:174px;}
#t26_5{left:83px;bottom:134px;}
#t27_5{left:89px;bottom:130px;letter-spacing:-0.1px;}
#t28_5{left:83px;bottom:116px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t29_5{left:83px;bottom:102px;}
#t2a_5{left:503px;bottom:1085px;letter-spacing:-0.1px;word-spacing:-0.9px;}
#t2b_5{left:593px;bottom:1085px;letter-spacing:-0.1px;word-spacing:-0.9px;}
#t2c_5{left:484px;bottom:1070px;letter-spacing:-0.2px;word-spacing:-1px;}
#t2d_5{left:484px;bottom:1055px;word-spacing:8.3px;}
#t2e_5{left:484px;bottom:1039px;letter-spacing:-0.1px;word-spacing:2.3px;}
#t2f_5{left:484px;bottom:1024px;letter-spacing:-0.2px;word-spacing:1.2px;}
#t2g_5{left:484px;bottom:1009px;word-spacing:1.4px;}
#t2h_5{left:484px;bottom:994px;word-spacing:1.8px;}
#t2i_5{left:484px;bottom:979px;word-spacing:-1.6px;}
#t2j_5{left:484px;bottom:963px;word-spacing:-0.9px;}
#t2k_5{left:484px;bottom:948px;letter-spacing:-0.3px;word-spacing:0.6px;}
#t2l_5{left:503px;bottom:933px;}
#t2m_5{left:604px;bottom:933px;letter-spacing:-0.2px;word-spacing:0.3px;}
#t2n_5{left:503px;bottom:918px;letter-spacing:-0.1px;word-spacing:3.5px;}
#t2o_5{left:484px;bottom:902px;letter-spacing:-0.1px;word-spacing:6.8px;}
#t2p_5{left:760px;bottom:902px;}
#t2q_5{left:825px;bottom:902px;}
#t2r_5{left:484px;bottom:887px;word-spacing:6.7px;}
#t2s_5{left:484px;bottom:872px;letter-spacing:-0.1px;word-spacing:0.9px;}
#t2t_5{left:484px;bottom:857px;letter-spacing:-0.1px;word-spacing:2.5px;}
#t2u_5{left:484px;bottom:842px;word-spacing:1.5px;}
#t2v_5{left:484px;bottom:826px;letter-spacing:-0.1px;word-spacing:0.2px;}
#t2w_5{left:503px;bottom:811px;word-spacing:6.8px;}
#t2x_5{left:484px;bottom:796px;word-spacing:-0.7px;}
#t2y_5{left:484px;bottom:781px;word-spacing:-1.7px;}
#t2z_5{left:484px;bottom:765px;}
#t30_5{left:538px;bottom:765px;word-spacing:-2.5px;}
#t31_5{left:484px;bottom:750px;word-spacing:8.8px;}
#t32_5{left:484px;bottom:735px;word-spacing:1.4px;}
#t33_5{left:772px;bottom:735px;}
#t34_5{left:846px;bottom:735px;}
#t35_5{left:484px;bottom:720px;word-spacing:0.8px;}
#t36_5{left:484px;bottom:705px;letter-spacing:-0.1px;word-spacing:5.1px;}
#t37_5{left:484px;bottom:689px;letter-spacing:-0.1px;word-spacing:6.6px;}
#t38_5{left:484px;bottom:674px;word-spacing:-0.7px;}
#t39_5{left:484px;bottom:659px;word-spacing:3.2px;}
#t3a_5{left:484px;bottom:644px;letter-spacing:-0.2px;word-spacing:3.9px;}
#t3b_5{left:484px;bottom:628px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t3c_5{left:503px;bottom:613px;letter-spacing:-0.1px;word-spacing:4.8px;}
#t3d_5{left:484px;bottom:598px;letter-spacing:-0.1px;word-spacing:-0.2px;}
#t3e_5{left:752px;bottom:598px;}
#t3f_5{left:792px;bottom:598px;}
#t3g_5{left:806px;bottom:598px;}
#t3h_5{left:484px;bottom:583px;word-spacing:2.7px;}
#t3i_5{left:484px;bottom:568px;letter-spacing:-0.2px;word-spacing:0.4px;}
#t3j_5{left:503px;bottom:552px;letter-spacing:-0.2px;word-spacing:6px;}
#t3k_5{left:484px;bottom:537px;letter-spacing:-0.2px;word-spacing:2.2px;}
#t3l_5{left:484px;bottom:522px;letter-spacing:-0.1px;word-spacing:4.9px;}
#t3m_5{left:484px;bottom:507px;letter-spacing:-0.2px;word-spacing:2.7px;}
#t3n_5{left:484px;bottom:491px;letter-spacing:-0.1px;word-spacing:4.1px;}
#t3o_5{left:484px;bottom:476px;word-spacing:0.2px;}
#t3p_5{left:484px;bottom:461px;letter-spacing:-0.1px;word-spacing:8.5px;}
#t3q_5{left:484px;bottom:446px;word-spacing:2.1px;}
#t3r_5{left:484px;bottom:431px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t3s_5{left:484px;bottom:415px;letter-spacing:-0.1px;word-spacing:-1.9px;}
#t3t_5{left:484px;bottom:400px;letter-spacing:-0.2px;word-spacing:0.7px;}
#t3u_5{left:484px;bottom:385px;letter-spacing:-0.1px;word-spacing:3.5px;}
#t3v_5{left:484px;bottom:370px;letter-spacing:-0.1px;word-spacing:-1.1px;}
#t3w_5{left:484px;bottom:354px;word-spacing:0.9px;}
#t3x_5{left:484px;bottom:339px;}
#t3y_5{left:503px;bottom:324px;word-spacing:2.5px;}
#t3z_5{left:484px;bottom:309px;letter-spacing:-0.1px;word-spacing:6px;}
#t40_5{left:484px;bottom:294px;letter-spacing:-0.1px;word-spacing:6.3px;}
#t41_5{left:484px;bottom:278px;letter-spacing:-0.1px;word-spacing:2.7px;}
#t42_5{left:484px;bottom:263px;letter-spacing:-0.1px;word-spacing:7.7px;}
#t43_5{left:484px;bottom:248px;word-spacing:4.5px;}
#t44_5{left:484px;bottom:233px;word-spacing:0.3px;}
#t45_5{left:484px;bottom:218px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t46_5{left:503px;bottom:202px;letter-spacing:-0.1px;word-spacing:9.7px;}
#t47_5{left:613px;bottom:202px;letter-spacing:-0.1px;word-spacing:9.7px;}
#t48_5{left:484px;bottom:187px;word-spacing:2.8px;}
#t49_5{left:484px;bottom:172px;word-spacing:-1.7px;}
#t4a_5{left:484px;bottom:157px;word-spacing:0.8px;}
#t4b_5{left:484px;bottom:141px;word-spacing:-1.8px;}
#t4c_5{left:484px;bottom:126px;word-spacing:2px;}
#t4d_5{left:484px;bottom:111px;}

.s1_5{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s2_5{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-ReguItal_x;
	color: rgb(0,0,0);
}

.s3_5{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

.s4_5{
	FONT-SIZE: 36.5px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s5_5{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMTT9_o;
	color: rgb(0,0,0);
}

.s6_5{
	FONT-SIZE: 48.7px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts5" type="text/css" >

@font-face {
	font-family: CMTT9_o;
	src: url("fonts/CMTT9_o.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Medi_6;
	src: url("fonts/NimbusRomNo9L-Medi_6.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-ReguItal_x;
	src: url("fonts/NimbusRomNo9L-ReguItal_x.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Regu_9;
	src: url("fonts/NimbusRomNo9L-Regu_9.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg5Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg5" style="-webkit-user-select: none;"><object width="935" height="1210" data="5/5.svg" type="image/svg+xml" id="pdf5" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div id="t1_5" class="t s1_5">resentations are assigned an integer key called the</div>
<div id="t2_5" class="t s2_5">object shape</div>
<div id="t3_5" class="t s1_5">.</div>
<div id="t4_5" class="t s1_5">Thus, the guard is a simple equality check on the object shape.</div>
<div id="t5_5" class="t s3_5">Representation specialization: numbers.</div>
<div id="t6_5" class="t s1_5">JavaScript has no</div>
<div id="t7_5" class="t s1_5">integer type, only a Number type that is the set of 64-bit IEEE-</div>
<div id="t8_5" class="t s1_5">754 ﬂoating-pointer numbers (“doubles”). But many JavaScript</div>
<div id="t9_5" class="t s1_5">operators, in particular array accesses and bitwise operators, really</div>
<div id="ta_5" class="t s1_5">operate on integers, so they ﬁrst convert the number to an integer,</div>
<div id="tb_5" class="t s1_5">and then convert any integer result back to a double.</div>
<div id="tc_5" class="t s4_5">1</div>
<div id="td_5" class="t s1_5">Clearly, a</div>
<div id="te_5" class="t s1_5">JavaScript VM that wants to be fast must ﬁnd a way to operate on</div>
<div id="tf_5" class="t s1_5">integers directly and avoid these conversions.</div>
<div id="tg_5" class="t s1_5">In TraceMonkey, we support two representations for numbers:</div>
<div id="th_5" class="t s1_5">integers and doubles. The interpreter uses integer representations</div>
<div id="ti_5" class="t s1_5">as much as it can, switching for results that can only be represented</div>
<div id="tj_5" class="t s1_5">as doubles. When a trace is started, some values may be imported</div>
<div id="tk_5" class="t s1_5">and represented as integers. Some operations on integers require</div>
<div id="tl_5" class="t s1_5">guards. For example, adding two integers can produce a value too</div>
<div id="tm_5" class="t s1_5">large for the integer representation.</div>
<div id="tn_5" class="t s3_5">Function inlining.</div>
<div id="to_5" class="t s1_5">LIR traces can cross function boundaries</div>
<div id="tp_5" class="t s1_5">in either direction, achieving function inlining. Move instructions</div>
<div id="tq_5" class="t s1_5">need to be recorded for function entry and exit to copy arguments</div>
<div id="tr_5" class="t s1_5">in and return values out. These move statements are then optimized</div>
<div id="ts_5" class="t s1_5">away by the compiler using copy propagation. In order to be able</div>
<div id="tt_5" class="t s1_5">to return to the interpreter, the trace must also generate LIR to</div>
<div id="tu_5" class="t s1_5">record that a call frame has been entered and exited. The frame</div>
<div id="tv_5" class="t s1_5">entry and exit LIR saves just enough information to allow the</div>
<div id="tw_5" class="t s1_5">intepreter call stack to be restored later and is much simpler than</div>
<div id="tx_5" class="t s1_5">the interpreter’s standard call code. If the function being entered</div>
<div id="ty_5" class="t s1_5">is not constant (which in JavaScript includes any call by function</div>
<div id="tz_5" class="t s1_5">name), the recorder must also emit LIR to guard that the function</div>
<div id="t10_5" class="t s1_5">is the same.</div>
<div id="t11_5" class="t s3_5">Guards and side exits.</div>
<div id="t12_5" class="t s1_5">Each optimization described above</div>
<div id="t13_5" class="t s1_5">requires one or more guards to verify the assumptions made in</div>
<div id="t14_5" class="t s1_5">doing the optimization. A guard is just a group of LIR instructions</div>
<div id="t15_5" class="t s1_5">that performs a test and conditional exit. The exit branches to a</div>
<div id="t16_5" class="t s2_5">side exit</div>
<div id="t17_5" class="t s1_5">, a small off-trace piece of LIR that returns a pointer to</div>
<div id="t18_5" class="t s1_5">a structure that describes the reason for the exit along with the</div>
<div id="t19_5" class="t s1_5">interpreter PC at the exit point and any other data needed to restore</div>
<div id="t1a_5" class="t s1_5">the interpreter’s state structures.</div>
<div id="t1b_5" class="t s3_5">Aborts.</div>
<div id="t1c_5" class="t s1_5">Some constructs are difﬁcult to record in LIR traces.</div>
<div id="t1d_5" class="t s1_5">For example,</div>
<div id="t1e_5" class="t s5_5">eval</div>
<div id="t1f_5" class="t s1_5">or calls to external functions can change the</div>
<div id="t1g_5" class="t s1_5">program state in unpredictable ways, making it difﬁcult for the</div>
<div id="t1h_5" class="t s1_5">tracer to know the current type map in order to continue tracing.</div>
<div id="t1i_5" class="t s1_5">A tracing implementation can also have any number of other limi-</div>
<div id="t1j_5" class="t s1_5">tations, e.g.,a small-memory device may limit the length of traces.</div>
<div id="t1k_5" class="t s1_5">When any situation occurs that prevents the implementation from</div>
<div id="t1l_5" class="t s1_5">continuing trace recording, the implementation</div>
<div id="t1m_5" class="t s2_5">aborts</div>
<div id="t1n_5" class="t s1_5">trace record-</div>
<div id="t1o_5" class="t s1_5">ing and returns to the trace monitor.</div>
<div id="t1p_5" class="t s3_5">3.2</div>
<div id="t1q_5" class="t s3_5">Trace Trees</div>
<div id="t1r_5" class="t s1_5">Especially simple loops, namely those where control ﬂow, value</div>
<div id="t1s_5" class="t s1_5">types, value representations, and inlined functions are all invariant,</div>
<div id="t1t_5" class="t s1_5">can be represented by a single trace. But most loops have at least</div>
<div id="t1u_5" class="t s1_5">some variation, and so the program will take side exits from the</div>
<div id="t1v_5" class="t s1_5">main trace. When a side exit becomes hot, TraceMonkey starts a</div>
<div id="t1w_5" class="t s1_5">new</div>
<div id="t1x_5" class="t s2_5">branch trace</div>
<div id="t1y_5" class="t s1_5">from that point and patches the side exit to jump</div>
<div id="t1z_5" class="t s1_5">directly to that trace. In this way, a single trace expands on demand</div>
<div id="t20_5" class="t s1_5">to a single-entry, multiple-exit</div>
<div id="t21_5" class="t s2_5">trace tree</div>
<div id="t22_5" class="t s1_5">.</div>
<div id="t23_5" class="t s1_5">This section explains how trace trees are formed during execu-</div>
<div id="t24_5" class="t s1_5">tion. The goal is to form trace trees during execution that cover all</div>
<div id="t25_5" class="t s1_5">the hot paths of the program.</div>
<div id="t26_5" class="t s4_5">1</div>
<div id="t27_5" class="t s6_5">Arrays are actually worse than this: if the index value is a number, it must</div>
<div id="t28_5" class="t s6_5">be converted from a double to a string for the property access operator, and</div>
<div id="t29_5" class="t s6_5">then to an integer internally to the array implementation.</div>
<div id="t2a_5" class="t s3_5">Starting a tree.</div>
<div id="t2b_5" class="t s1_5">Tree trees always start at loop headers, because</div>
<div id="t2c_5" class="t s1_5">they are a natural place to look for hot paths. In TraceMonkey, loop</div>
<div id="t2d_5" class="t s1_5">headers are easy to detect–the bytecode compiler ensures that a</div>
<div id="t2e_5" class="t s1_5">bytecode is a loop header iff it is the target of a backward branch.</div>
<div id="t2f_5" class="t s1_5">TraceMonkey starts a tree when a given loop header has been exe-</div>
<div id="t2g_5" class="t s1_5">cuted a certain number of times (2 in the current implementation).</div>
<div id="t2h_5" class="t s1_5">Starting a tree just means starting recording a trace for the current</div>
<div id="t2i_5" class="t s1_5">point and type map and marking the trace as the root of a tree. Each</div>
<div id="t2j_5" class="t s1_5">tree is associated with a loop header and type map, so there may be</div>
<div id="t2k_5" class="t s1_5">several trees for a given loop header.</div>
<div id="t2l_5" class="t s3_5">Closing the loop.</div>
<div id="t2m_5" class="t s1_5">Trace recording can end in several ways.</div>
<div id="t2n_5" class="t s1_5">Ideally, the trace reaches the loop header where it started with</div>
<div id="t2o_5" class="t s1_5">the same type map as on entry. This is called a</div>
<div id="t2p_5" class="t s2_5">type-stable</div>
<div id="t2q_5" class="t s1_5">loop</div>
<div id="t2r_5" class="t s1_5">iteration. In this case, the end of the trace can jump right to the</div>
<div id="t2s_5" class="t s1_5">beginning, as all the value representations are exactly as needed to</div>
<div id="t2t_5" class="t s1_5">enter the trace. The jump can even skip the usual code that would</div>
<div id="t2u_5" class="t s1_5">copy out the state at the end of the trace and copy it back in to the</div>
<div id="t2v_5" class="t s1_5">trace activation record to enter a trace.</div>
<div id="t2w_5" class="t s1_5">In certain cases the trace might reach the loop header with a</div>
<div id="t2x_5" class="t s1_5">different type map. This scenario is sometime observed for the ﬁrst</div>
<div id="t2y_5" class="t s1_5">iteration of a loop. Some variables inside the loop might initially be</div>
<div id="t2z_5" class="t s2_5">undeﬁned</div>
<div id="t30_5" class="t s1_5">, before they are set to a concrete type during the ﬁrst loop</div>
<div id="t31_5" class="t s1_5">iteration. When recording such an iteration, the recorder cannot</div>
<div id="t32_5" class="t s1_5">link the trace back to its own loop header since it is</div>
<div id="t33_5" class="t s2_5">type-unstable</div>
<div id="t34_5" class="t s1_5">.</div>
<div id="t35_5" class="t s1_5">Instead, the iteration is terminated with a side exit that will always</div>
<div id="t36_5" class="t s1_5">fail and return to the interpreter. At the same time a new trace is</div>
<div id="t37_5" class="t s1_5">recorded with the new type map. Every time an additional type-</div>
<div id="t38_5" class="t s1_5">unstable trace is added to a region, its exit type map is compared to</div>
<div id="t39_5" class="t s1_5">the entry map of all existing traces in case they complement each</div>
<div id="t3a_5" class="t s1_5">other. With this approach we are able to cover type-unstable loop</div>
<div id="t3b_5" class="t s1_5">iterations as long they eventually form a stable equilibrium.</div>
<div id="t3c_5" class="t s1_5">Finally, the trace might exit the loop before reaching the loop</div>
<div id="t3d_5" class="t s1_5">header, for example because execution reaches a</div>
<div id="t3e_5" class="t s5_5">break</div>
<div id="t3f_5" class="t s1_5">or</div>
<div id="t3g_5" class="t s5_5">return</div>
<div id="t3h_5" class="t s1_5">statement. In this case, the VM simply ends the trace with an exit</div>
<div id="t3i_5" class="t s1_5">to the trace monitor.</div>
<div id="t3j_5" class="t s1_5">As mentioned previously, we may speculatively chose to rep-</div>
<div id="t3k_5" class="t s1_5">resent certain Number-typed values as integers on trace. We do so</div>
<div id="t3l_5" class="t s1_5">when we observe that Number-typed variables contain an integer</div>
<div id="t3m_5" class="t s1_5">value at trace entry. If during trace recording the variable is unex-</div>
<div id="t3n_5" class="t s1_5">pectedly assigned a non-integer value, we have to widen the type</div>
<div id="t3o_5" class="t s1_5">of the variable to a double. As a result, the recorded trace becomes</div>
<div id="t3p_5" class="t s1_5">inherently type-unstable since it starts with an integer value but</div>
<div id="t3q_5" class="t s1_5">ends with a double value. This represents a mis-speculation, since</div>
<div id="t3r_5" class="t s1_5">at trace entry we specialized the Number-typed value to an integer,</div>
<div id="t3s_5" class="t s1_5">assuming that at the loop edge we would again ﬁnd an integer value</div>
<div id="t3t_5" class="t s1_5">in the variable, allowing us to close the loop. To avoid future spec-</div>
<div id="t3u_5" class="t s1_5">ulative failures involving this variable, and to obtain a type-stable</div>
<div id="t3v_5" class="t s1_5">trace we note the fact that the variable in question as been observed</div>
<div id="t3w_5" class="t s1_5">to sometimes hold non-integer values in an advisory data structure</div>
<div id="t3x_5" class="t s1_5">which we call the “oracle”.</div>
<div id="t3y_5" class="t s1_5">When compiling loops, we consult the oracle before specializ-</div>
<div id="t3z_5" class="t s1_5">ing values to integers. Speculation towards integers is performed</div>
<div id="t40_5" class="t s1_5">only if no adverse information is known to the oracle about that</div>
<div id="t41_5" class="t s1_5">particular variable. Whenever we accidentally compile a loop that</div>
<div id="t42_5" class="t s1_5">is type-unstable due to mis-speculation of a Number-typed vari-</div>
<div id="t43_5" class="t s1_5">able, we immediately trigger the recording of a new trace, which</div>
<div id="t44_5" class="t s1_5">based on the now updated oracle information will start with a dou-</div>
<div id="t45_5" class="t s1_5">ble value and thus become type stable.</div>
<div id="t46_5" class="t s3_5">Extending a tree.</div>
<div id="t47_5" class="t s1_5">Side exits lead to different paths through</div>
<div id="t48_5" class="t s1_5">the loop, or paths with different types or representations. Thus, to</div>
<div id="t49_5" class="t s1_5">completely cover the loop, the VM must record traces starting at all</div>
<div id="t4a_5" class="t s1_5">side exits. These traces are recorded much like root traces: there is</div>
<div id="t4b_5" class="t s1_5">a counter for each side exit, and when the counter reaches a hotness</div>
<div id="t4c_5" class="t s1_5">threshold, recording starts. Recording stops exactly as for the root</div>
<div id="t4d_5" class="t s1_5">trace, using the loop header of the root trace as the target to reach.</div>

<!-- End text definitions -->


</div>
</body>
</html>
