<!DOCTYPE html >
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p10" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	-webkit-transform-origin: bottom left;
	-ms-transform-origin: bottom left;
	transform-origin: bottom left;
	-webkit-transform: scale(0.25);
	-ms-transform: scale(0.25);
	transform: scale(0.25);
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_10{left:83px;bottom:1085px;}
#t2_10{left:113px;bottom:1085px;word-spacing:0.1px;}
#t3_10{left:83px;bottom:1064px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t4_10{left:83px;bottom:1049px;letter-spacing:-0.1px;word-spacing:-0.9px;}
#t5_10{left:83px;bottom:1033px;word-spacing:2.9px;}
#t6_10{left:83px;bottom:1018px;letter-spacing:-0.1px;word-spacing:-1.3px;}
#t7_10{left:83px;bottom:1003px;word-spacing:3.5px;}
#t8_10{left:83px;bottom:988px;word-spacing:-2px;}
#t9_10{left:83px;bottom:972px;word-spacing:1.7px;}
#ta_10{left:83px;bottom:957px;word-spacing:-1.4px;}
#tb_10{left:83px;bottom:942px;letter-spacing:-0.2px;word-spacing:6.9px;}
#tc_10{left:282px;bottom:942px;}
#td_10{left:402px;bottom:942px;}
#te_10{left:82px;bottom:927px;letter-spacing:-0.1px;word-spacing:4.3px;}
#tf_10{left:82px;bottom:912px;word-spacing:-1.8px;}
#tg_10{left:82px;bottom:896px;}
#th_10{left:101px;bottom:881px;letter-spacing:-0.1px;word-spacing:-1.2px;}
#ti_10{left:82px;bottom:866px;word-spacing:4.4px;}
#tj_10{left:82px;bottom:851px;letter-spacing:-0.1px;word-spacing:1.1px;}
#tk_10{left:82px;bottom:835px;letter-spacing:-0.1px;word-spacing:0.2px;}
#tl_10{left:101px;bottom:820px;word-spacing:5px;}
#tm_10{left:82px;bottom:805px;word-spacing:2.9px;}
#tn_10{left:82px;bottom:790px;}
#to_10{left:101px;bottom:775px;letter-spacing:-0.2px;word-spacing:3.7px;}
#tp_10{left:82px;bottom:759px;word-spacing:6.1px;}
#tq_10{left:82px;bottom:744px;word-spacing:4.3px;}
#tr_10{left:82px;bottom:729px;word-spacing:12.2px;}
#ts_10{left:323px;bottom:729px;letter-spacing:2.7px;}
#tt_10{left:362px;bottom:729px;}
#tu_10{left:370px;bottom:729px;letter-spacing:0.8px;}
#tv_10{left:408px;bottom:729px;word-spacing:13.4px;}
#tw_10{left:436px;bottom:729px;}
#tx_10{left:443px;bottom:729px;}
#ty_10{left:83px;bottom:714px;letter-spacing:2.6px;}
#tz_10{left:126px;bottom:714px;}
#t10_10{left:135px;bottom:714px;letter-spacing:0.8px;}
#t11_10{left:165px;bottom:714px;word-spacing:-1px;}
#t12_10{left:83px;bottom:698px;}
#t13_10{left:93px;bottom:699px;letter-spacing:2.6px;}
#t14_10{left:144px;bottom:698px;}
#t15_10{left:152px;bottom:699px;letter-spacing:0.8px;}
#t16_10{left:186px;bottom:698px;word-spacing:-1.1px;}
#t17_10{left:82px;bottom:683px;letter-spacing:-0.4px;word-spacing:6.6px;}
#t18_10{left:192px;bottom:684px;letter-spacing:2.7px;}
#t19_10{left:231px;bottom:683px;}
#t1a_10{left:239px;bottom:684px;letter-spacing:0.8px;}
#t1b_10{left:275px;bottom:683px;word-spacing:5.2px;}
#t1c_10{left:82px;bottom:668px;word-spacing:-1.5px;}
#t1d_10{left:83px;bottom:653px;}
#t1e_10{left:93px;bottom:653px;letter-spacing:2.6px;}
#t1f_10{left:144px;bottom:653px;}
#t1g_10{left:152px;bottom:653px;letter-spacing:0.8px;}
#t1h_10{left:187px;bottom:653px;word-spacing:2.9px;}
#t1i_10{left:82px;bottom:638px;word-spacing:-0.9px;}
#t1j_10{left:101px;bottom:622px;letter-spacing:-0.1px;word-spacing:10.3px;}
#t1k_10{left:82px;bottom:607px;word-spacing:-0.8px;}
#t1l_10{left:82px;bottom:592px;word-spacing:7.6px;}
#t1m_10{left:82px;bottom:577px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t1n_10{left:101px;bottom:561px;word-spacing:14px;}
#t1o_10{left:82px;bottom:546px;word-spacing:-2.8px;}
#t1p_10{left:82px;bottom:531px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t1q_10{left:101px;bottom:516px;word-spacing:-0.8px;}
#t1r_10{left:82px;bottom:501px;word-spacing:2.1px;}
#t1s_10{left:82px;bottom:485px;letter-spacing:-0.1px;word-spacing:-1.5px;}
#t1t_10{left:82px;bottom:470px;letter-spacing:-0.1px;word-spacing:-2.5px;}
#t1u_10{left:82px;bottom:455px;}
#t1v_10{left:101px;bottom:440px;letter-spacing:-0.1px;word-spacing:-0.9px;}
#t1w_10{left:82px;bottom:425px;word-spacing:-2.4px;}
#t1x_10{left:82px;bottom:409px;letter-spacing:-0.1px;word-spacing:1.9px;}
#t1y_10{left:82px;bottom:394px;letter-spacing:-0.1px;word-spacing:8.1px;}
#t1z_10{left:82px;bottom:379px;letter-spacing:-0.2px;word-spacing:0.4px;}
#t20_10{left:101px;bottom:364px;letter-spacing:-0.1px;word-spacing:9.7px;}
#t21_10{left:82px;bottom:348px;letter-spacing:-0.1px;word-spacing:6.7px;}
#t22_10{left:82px;bottom:333px;word-spacing:3.9px;}
#t23_10{left:82px;bottom:318px;letter-spacing:-0.2px;word-spacing:0.4px;}
#t24_10{left:101px;bottom:303px;letter-spacing:-0.1px;word-spacing:0.7px;}
#t25_10{left:82px;bottom:288px;word-spacing:2.8px;}
#t26_10{left:82px;bottom:272px;word-spacing:0.1px;}
#t27_10{left:82px;bottom:245px;}
#t28_10{left:113px;bottom:245px;letter-spacing:-0.1px;}
#t29_10{left:82px;bottom:224px;letter-spacing:-0.1px;word-spacing:12.9px;}
#t2a_10{left:82px;bottom:208px;word-spacing:6.3px;}
#t2b_10{left:82px;bottom:193px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t2c_10{left:101px;bottom:178px;letter-spacing:-0.1px;word-spacing:5.5px;}
#t2d_10{left:82px;bottom:163px;letter-spacing:-0.4px;}
#t2e_10{left:120px;bottom:163px;letter-spacing:2.7px;}
#t2f_10{left:186px;bottom:163px;letter-spacing:-0.1px;word-spacing:5.3px;}
#t2g_10{left:82px;bottom:147px;letter-spacing:-0.1px;word-spacing:7.3px;}
#t2h_10{left:382px;bottom:148px;letter-spacing:2.7px;}
#t2i_10{left:82px;bottom:132px;word-spacing:3.4px;}
#t2j_10{left:82px;bottom:117px;letter-spacing:-0.1px;word-spacing:-0.5px;}
#t2k_10{left:82px;bottom:102px;letter-spacing:-0.2px;word-spacing:-2.7px;}
#t2l_10{left:576px;bottom:812px;}
#t2m_10{left:600px;bottom:812px;}
#t2n_10{left:627px;bottom:812px;}
#t2o_10{left:653px;bottom:812px;}
#t2p_10{left:679px;bottom:812px;}
#t2q_10{left:705px;bottom:812px;}
#t2r_10{left:732px;bottom:812px;}
#t2s_10{left:758px;bottom:812px;}
#t2t_10{left:784px;bottom:812px;}
#t2u_10{left:810px;bottom:812px;}
#t2v_10{left:835px;bottom:812px;}
#t2w_10{left:535px;bottom:830px;word-spacing:-0.6px;}
#t2x_10{left:530px;bottom:841px;word-spacing:-0.6px;}
#t2y_10{left:526px;bottom:851px;letter-spacing:-0.1px;word-spacing:-0.5px;}
#t2z_10{left:505px;bottom:861px;word-spacing:-0.6px;}
#t30_10{left:513px;bottom:871px;word-spacing:-0.5px;}
#t31_10{left:520px;bottom:881px;word-spacing:-0.6px;}
#t32_10{left:520px;bottom:891px;word-spacing:-0.6px;}
#t33_10{left:491px;bottom:901px;word-spacing:-0.6px;}
#t34_10{left:507px;bottom:911px;word-spacing:-0.6px;}
#t35_10{left:503px;bottom:921px;word-spacing:-0.6px;}
#t36_10{left:509px;bottom:931px;word-spacing:-0.6px;}
#t37_10{left:499px;bottom:941px;letter-spacing:-0.1px;word-spacing:-0.5px;}
#t38_10{left:528px;bottom:951px;word-spacing:-0.6px;}
#t39_10{left:525px;bottom:961px;word-spacing:-0.6px;}
#t3a_10{left:525px;bottom:971px;word-spacing:-0.6px;}
#t3b_10{left:509px;bottom:982px;letter-spacing:-0.1px;word-spacing:-0.4px;}
#t3c_10{left:507px;bottom:992px;letter-spacing:-0.1px;word-spacing:-0.4px;}
#t3d_10{left:524px;bottom:1002px;word-spacing:-0.6px;}
#t3e_10{left:507px;bottom:1012px;word-spacing:-0.6px;}
#t3f_10{left:502px;bottom:1022px;word-spacing:-0.6px;}
#t3g_10{left:527px;bottom:1032px;letter-spacing:-0.1px;word-spacing:-0.5px;}
#t3h_10{left:520px;bottom:1042px;word-spacing:-0.6px;}
#t3i_10{left:527px;bottom:1052px;letter-spacing:-0.1px;word-spacing:-0.5px;}
#t3j_10{left:516px;bottom:1062px;word-spacing:-0.6px;}
#t3k_10{left:505px;bottom:1072px;letter-spacing:-0.1px;word-spacing:-0.5px;}
#t3l_10{left:502px;bottom:1082px;word-spacing:-0.5px;}
#t3m_10{left:629px;bottom:786px;letter-spacing:-0.1px;}
#t3n_10{left:702px;bottom:786px;letter-spacing:-0.1px;}
#t3o_10{left:484px;bottom:738px;letter-spacing:-0.1px;word-spacing:8px;}
#t3p_10{left:484px;bottom:723px;letter-spacing:-0.1px;word-spacing:0.6px;}
#t3q_10{left:649px;bottom:723px;letter-spacing:-0.1px;word-spacing:0.5px;}
#t3r_10{left:484px;bottom:707px;letter-spacing:-0.1px;word-spacing:8.8px;}
#t3s_10{left:484px;bottom:692px;word-spacing:10.7px;}
#t3t_10{left:484px;bottom:677px;}
#t3u_10{left:504px;bottom:677px;}
#t3v_10{left:576px;bottom:677px;letter-spacing:-0.1px;word-spacing:1.9px;}
#t3w_10{left:484px;bottom:662px;word-spacing:5.9px;}
#t3x_10{left:484px;bottom:646px;word-spacing:2.9px;}
#t3y_10{left:484px;bottom:631px;letter-spacing:-0.1px;word-spacing:0.3px;}
#t3z_10{left:484px;bottom:586px;word-spacing:1px;}
#t40_10{left:484px;bottom:571px;letter-spacing:-0.1px;word-spacing:-2.9px;}
#t41_10{left:484px;bottom:533px;}
#t42_10{left:514px;bottom:533px;letter-spacing:-0.1px;}
#t43_10{left:484px;bottom:513px;letter-spacing:-0.2px;word-spacing:10.3px;}
#t44_10{left:484px;bottom:498px;letter-spacing:-0.1px;word-spacing:2.4px;}
#t45_10{left:484px;bottom:482px;word-spacing:4.1px;}
#t46_10{left:484px;bottom:467px;letter-spacing:-0.1px;word-spacing:2.8px;}
#t47_10{left:484px;bottom:452px;letter-spacing:-0.1px;word-spacing:4.6px;}
#t48_10{left:484px;bottom:437px;word-spacing:1.1px;}
#t49_10{left:484px;bottom:421px;letter-spacing:-0.1px;word-spacing:-1.5px;}
#t4a_10{left:484px;bottom:406px;word-spacing:-1px;}
#t4b_10{left:484px;bottom:391px;}
#t4c_10{left:503px;bottom:376px;word-spacing:6.2px;}
#t4d_10{left:484px;bottom:361px;}
#t4e_10{left:503px;bottom:345px;letter-spacing:-0.1px;word-spacing:7.3px;}
#t4f_10{left:623px;bottom:345px;word-spacing:7.1px;}
#t4g_10{left:484px;bottom:330px;word-spacing:-0.5px;}
#t4h_10{left:484px;bottom:315px;letter-spacing:-0.2px;word-spacing:8px;}
#t4i_10{left:484px;bottom:300px;word-spacing:5.4px;}
#t4j_10{left:484px;bottom:284px;letter-spacing:-0.2px;word-spacing:2.2px;}
#t4k_10{left:484px;bottom:269px;letter-spacing:-0.1px;word-spacing:1.4px;}
#t4l_10{left:484px;bottom:254px;letter-spacing:-0.2px;word-spacing:1.7px;}
#t4m_10{left:484px;bottom:239px;letter-spacing:-0.2px;word-spacing:7.5px;}
#t4n_10{left:484px;bottom:224px;letter-spacing:-0.1px;word-spacing:0.1px;}
#t4o_10{left:503px;bottom:208px;letter-spacing:-0.1px;word-spacing:-2.6px;}
#t4p_10{left:484px;bottom:193px;letter-spacing:-0.1px;word-spacing:1.2px;}
#t4q_10{left:484px;bottom:178px;letter-spacing:-0.1px;word-spacing:0.5px;}
#t4r_10{left:484px;bottom:163px;}
#t4s_10{left:501px;bottom:163px;}
#t4t_10{left:631px;bottom:163px;}
#t4u_10{left:503px;bottom:147px;letter-spacing:-0.1px;word-spacing:10.4px;}
#t4v_10{left:484px;bottom:132px;}
#t4w_10{left:489px;bottom:132px;}
#t4x_10{left:546px;bottom:132px;}
#t4y_10{left:558px;bottom:132px;}
#t4z_10{left:730px;bottom:132px;}
#t50_10{left:742px;bottom:132px;}
#t51_10{left:484px;bottom:117px;}
#t52_10{left:506px;bottom:117px;}
#t53_10{left:513px;bottom:117px;}
#t54_10{left:592px;bottom:117px;}
#t55_10{left:599px;bottom:117px;}
#t56_10{left:678px;bottom:117px;}
#t57_10{left:685px;bottom:117px;}
#t58_10{left:807px;bottom:117px;}
#t59_10{left:814px;bottom:117px;}
#t5a_10{left:484px;bottom:102px;}
#t5b_10{left:578px;bottom:102px;}
#t5c_10{left:587px;bottom:102px;}
#t5d_10{left:681px;bottom:102px;}
#t5e_10{left:691px;bottom:102px;}
#t5f_10{left:842px;bottom:102px;}

.s1_10{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

.s2_10{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s3_10{
	FONT-SIZE: 54.8px;
	FONT-FAMILY: CMTT9_o;
	color: rgb(0,0,0);
}

.s4_10{
	FONT-SIZE: 43.8px;
	FONT-FAMILY: NimbusRomNo9L-Regu_9;
	color: rgb(0,0,0);
}

.s5_10{
	FONT-SIZE: 33.6px;
	FONT-FAMILY: BTMOLE-2BCalibri_5g;
	color: rgb(0,0,0);
}

.s6_10{
	FONT-SIZE: 26.9px;
	FONT-FAMILY: BTMOLE-2BCalibri_5g;
	color: rgb(0,0,0);
}

.s7_10{
	FONT-SIZE: 67px;
	FONT-FAMILY: NimbusRomNo9L-Medi_6;
	color: rgb(0,0,0);
}

</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts10" type="text/css" >

@font-face {
	font-family: BTMOLE-2BCalibri_5g;
	src: url("fonts/BTMOLE-2BCalibri_5g.woff") format("woff");
}

@font-face {
	font-family: CMTT9_o;
	src: url("fonts/CMTT9_o.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Medi_6;
	src: url("fonts/NimbusRomNo9L-Medi_6.woff") format("woff");
}

@font-face {
	font-family: NimbusRomNo9L-Regu_9;
	src: url("fonts/NimbusRomNo9L-Regu_9.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg10Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg10" style="-webkit-user-select: none;"><object width="935" height="1210" data="10/10.svg" type="image/svg+xml" id="pdf10" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div id="t1_10" class="t s1_10">6.5</div>
<div id="t2_10" class="t s1_10">Calling External Functions</div>
<div id="t3_10" class="t s2_10">Like most interpreters, SpiderMonkey has a foreign function inter-</div>
<div id="t4_10" class="t s2_10">face (FFI) that allows it to call C builtins and host system functions</div>
<div id="t5_10" class="t s2_10">(e.g., web browser control and DOM access). The FFI has a stan-</div>
<div id="t6_10" class="t s2_10">dard signature for JS-callable functions, the key argument of which</div>
<div id="t7_10" class="t s2_10">is an array of boxed values. External functions called through the</div>
<div id="t8_10" class="t s2_10">FFI interact with the program state through an interpreter API (e.g.,</div>
<div id="t9_10" class="t s2_10">to read a property from an argument). There are also certain inter-</div>
<div id="ta_10" class="t s2_10">preter builtins that do not use the FFI, but interact with the program</div>
<div id="tb_10" class="t s2_10">state in the same way, such as the</div>
<div id="tc_10" class="t s3_10">CallIteratorNext</div>
<div id="td_10" class="t s2_10">function</div>
<div id="te_10" class="t s2_10">used with iterator objects. TraceMonkey must support this FFI in</div>
<div id="tf_10" class="t s2_10">order to speed up code that interacts with the host system inside hot</div>
<div id="tg_10" class="t s2_10">loops.</div>
<div id="th_10" class="t s2_10">Calling external functions from TraceMonkey is potentially dif-</div>
<div id="ti_10" class="t s2_10">ﬁcult because traces do not update the interpreter state until exit-</div>
<div id="tj_10" class="t s2_10">ing. In particular, external functions may need the call stack or the</div>
<div id="tk_10" class="t s2_10">global variables, but they may be out of date.</div>
<div id="tl_10" class="t s2_10">For the out-of-date call stack problem, we refactored some of</div>
<div id="tm_10" class="t s2_10">the interpreter API implementation functions to re-materialize the</div>
<div id="tn_10" class="t s2_10">interpreter call stack on demand.</div>
<div id="to_10" class="t s2_10">We developed a C++ static analysis and annotated some inter-</div>
<div id="tp_10" class="t s2_10">preter functions in order to verify that the call stack is refreshed</div>
<div id="tq_10" class="t s2_10">at any point it needs to be used. In order to access the call stack,</div>
<div id="tr_10" class="t s2_10">a function must be annotated as either F</div>
<div id="ts_10" class="t s4_10">ORCES</div>
<div id="tt_10" class="t s2_10">S</div>
<div id="tu_10" class="t s4_10">TACK</div>
<div id="tv_10" class="t s2_10">or R</div>
<div id="tw_10" class="t s4_10">E</div>
<div id="tx_10" class="t s2_10">-</div>
<div id="ty_10" class="t s4_10">QUIRES</div>
<div id="tz_10" class="t s2_10">S</div>
<div id="t10_10" class="t s4_10">TACK</div>
<div id="t11_10" class="t s2_10">. These annotations are also required in order to call</div>
<div id="t12_10" class="t s2_10">R</div>
<div id="t13_10" class="t s4_10">EQUIRES</div>
<div id="t14_10" class="t s2_10">S</div>
<div id="t15_10" class="t s4_10">TACK</div>
<div id="t16_10" class="t s2_10">functions, which are presumed to access the call</div>
<div id="t17_10" class="t s2_10">stack transitively. F</div>
<div id="t18_10" class="t s4_10">ORCES</div>
<div id="t19_10" class="t s2_10">S</div>
<div id="t1a_10" class="t s4_10">TACK</div>
<div id="t1b_10" class="t s2_10">is a trusted annotation, applied</div>
<div id="t1c_10" class="t s2_10">to only 5 functions, that means the function refreshes the call stack.</div>
<div id="t1d_10" class="t s2_10">R</div>
<div id="t1e_10" class="t s4_10">EQUIRES</div>
<div id="t1f_10" class="t s2_10">S</div>
<div id="t1g_10" class="t s4_10">TACK</div>
<div id="t1h_10" class="t s2_10">is an untrusted annotation that means the func-</div>
<div id="t1i_10" class="t s2_10">tion may only be called if the call stack has already been refreshed.</div>
<div id="t1j_10" class="t s2_10">Similarly, we detect when host functions attempt to directly</div>
<div id="t1k_10" class="t s2_10">read or write global variables, and force the currently running trace</div>
<div id="t1l_10" class="t s2_10">to side exit. This is necessary since we cache and unbox global</div>
<div id="t1m_10" class="t s2_10">variables into the activation record during trace execution.</div>
<div id="t1n_10" class="t s2_10">Since both call-stack access and global variable access are</div>
<div id="t1o_10" class="t s2_10">rarely performed by host functions, performance is not signiﬁcantly</div>
<div id="t1p_10" class="t s2_10">affected by these safety mechanisms.</div>
<div id="t1q_10" class="t s2_10">Another problem is that external functions can reenter the inter-</div>
<div id="t1r_10" class="t s2_10">preter by calling scripts, which in turn again might want to access</div>
<div id="t1s_10" class="t s2_10">the call stack or global variables. To address this problem, we made</div>
<div id="t1t_10" class="t s2_10">the VM set a ﬂag whenever the interpreter is reentered while a com-</div>
<div id="t1u_10" class="t s2_10">piled trace is running.</div>
<div id="t1v_10" class="t s2_10">Every call to an external function then checks this ﬂag and exits</div>
<div id="t1w_10" class="t s2_10">the trace immediately after returning from the external function call</div>
<div id="t1x_10" class="t s2_10">if it is set. There are many external functions that seldom or never</div>
<div id="t1y_10" class="t s2_10">reenter, and they can be called without problem, and will cause</div>
<div id="t1z_10" class="t s2_10">trace exit only if necessary.</div>
<div id="t20_10" class="t s2_10">The FFI’s boxed value array requirement has a performance</div>
<div id="t21_10" class="t s2_10">cost, so we deﬁned a new FFI that allows C functions to be an-</div>
<div id="t22_10" class="t s2_10">notated with their argument types so that the tracer can call them</div>
<div id="t23_10" class="t s2_10">directly, without unnecessary argument conversions.</div>
<div id="t24_10" class="t s2_10">Currently, we do not support calling native property get and set</div>
<div id="t25_10" class="t s2_10">override functions or DOM functions directly from trace. Support</div>
<div id="t26_10" class="t s2_10">is planned future work.</div>
<div id="t27_10" class="t s1_10">6.6</div>
<div id="t28_10" class="t s1_10">Correctness</div>
<div id="t29_10" class="t s2_10">During development, we had access to existing JavaScript test</div>
<div id="t2a_10" class="t s2_10">suites, but most of them were not designed with tracing VMs in</div>
<div id="t2b_10" class="t s2_10">mind and contained few loops.</div>
<div id="t2c_10" class="t s2_10">One tool that helped us greatly was Mozilla’s JavaScript fuzz</div>
<div id="t2d_10" class="t s2_10">tester,</div>
<div id="t2e_10" class="t s4_10">JSFUNFUZZ</div>
<div id="t2f_10" class="t s2_10">, which generates random JavaScript programs</div>
<div id="t2g_10" class="t s2_10">by nesting random language elements. We modiﬁed</div>
<div id="t2h_10" class="t s4_10">JSFUNFUZZ</div>
<div id="t2i_10" class="t s2_10">to generate loops, and also to test more heavily certain constructs</div>
<div id="t2j_10" class="t s2_10">we suspected would reveal ﬂaws in our implementation. For exam-</div>
<div id="t2k_10" class="t s2_10">ple, we suspected bugs in TraceMonkey’s handling of type-unstable</div>
<div id="t2l_10" class="t s5_10">!"</div>
<div id="t2m_10" class="t s5_10">$!"</div>
<div id="t2n_10" class="t s5_10">%!"</div>
<div id="t2o_10" class="t s5_10">&amp;!"</div>
<div id="t2p_10" class="t s5_10">’!"</div>
<div id="t2q_10" class="t s5_10">(!"</div>
<div id="t2r_10" class="t s5_10">)!"</div>
<div id="t2s_10" class="t s5_10">*!"</div>
<div id="t2t_10" class="t s5_10">+!"</div>
<div id="t2u_10" class="t s5_10">,!"</div>
<div id="t2v_10" class="t s5_10">$!!"</div>
<div id="t2w_10" class="t s6_10">&amp;-./012 3%4%56</div>
<div id="t2x_10" class="t s6_10">&amp;-.789:; 3%4,56</div>
<div id="t2y_10" class="t s6_10">&amp;-.9&lt;=&gt;9&lt;/2 3$4%56</div>
<div id="t2z_10" class="t s6_10">&lt;//2??.1@A&lt;9=.&gt;922? 3!4,56</div>
<div id="t30_10" class="t s6_10">&lt;//2??.B&lt;AAC0/; 3%4%56</div>
<div id="t31_10" class="t s6_10">&lt;//2??.A18-= 3’4%56</div>
<div id="t32_10" class="t s6_10">&lt;//2??.A?@2D2 3&amp;4!56</div>
<div id="t33_10" class="t s6_10">1@&gt;8:?.&amp;1@&gt;.1@&gt;?.@A.1=&gt;2 3%(4(56</div>
<div id="t34_10" class="t s6_10">1@&gt;8:?.1@&gt;?.@A.1=&gt;2 3+4*56</div>
<div id="t35_10" class="t s6_10">1@&gt;8:?.1@&gt;E@?2.&lt;A- 3%(4%56</div>
<div id="t36_10" class="t s6_10">1@&gt;8:?.A?@2D2.1@&gt;? 3%4*56</div>
<div id="t37_10" class="t s6_10">/8A&gt;98FG8E.92/09?@D2 3$4!56</div>
<div id="t38_10" class="t s6_10">/9=:&gt;8.&lt;2? 3$4)56</div>
<div id="t39_10" class="t s6_10">/9=:&gt;8.7-( 3%4&amp;56</div>
<div id="t3a_10" class="t s6_10">/9=:&gt;8.?;&lt;$ 3(4,56</div>
<div id="t3b_10" class="t s6_10">-&lt;&gt;2.B897&lt;&gt;.&gt;8H2 3$4$56</div>
<div id="t3c_10" class="t s6_10">-&lt;&gt;2.B897&lt;&gt;.5:&lt;91 3$4!56</div>
<div id="t3d_10" class="t s6_10">7&lt;&gt;;./89-@/ 3’4,56</div>
<div id="t3e_10" class="t s6_10">7&lt;&gt;;.:&lt;9I&lt;F.?07? 3(4,56</div>
<div id="t3f_10" class="t s6_10">7&lt;&gt;;.?:2/&gt;9&lt;F.A897 3*4$56</div>
<div id="t3g_10" class="t s6_10">92J25:.-A&lt; 3’4%56</div>
<div id="t3h_10" class="t s6_10">?&gt;9@AJ.1&lt;?2)’ 3%4(56</div>
<div id="t3i_10" class="t s6_10">?&gt;9@AJ.B&lt;?&gt;&lt; 3$4(56</div>
<div id="t3j_10" class="t s6_10">?&gt;9@AJ.&gt;&lt;J/F80- 3$4$56</div>
<div id="t3k_10" class="t s6_10">?&gt;9@AJ.0A:&lt;/C./8-2 3$4%56</div>
<div id="t3l_10" class="t s6_10">?&gt;9@AJ.D&lt;F@-&lt;&gt;2.@A:0&gt; 3$4,56</div>
<div id="t3m_10" class="t s5_10">KA&gt;29:92&gt;</div>
<div id="t3n_10" class="t s5_10">L&lt;ID2</div>
<div id="t3o_10" class="t s1_10">Figure 11. Fraction of dynamic bytecodes executed by inter-</div>
<div id="t3p_10" class="t s1_10">preter and on native traces.</div>
<div id="t3q_10" class="t s2_10">The speedup vs. interpreter is shown</div>
<div id="t3r_10" class="t s2_10">in parentheses next to each test. The fraction of bytecodes exe-</div>
<div id="t3s_10" class="t s2_10">cuted while recording is too small to see in this ﬁgure, except</div>
<div id="t3t_10" class="t s2_10">for</div>
<div id="t3u_10" class="t s3_10">crypto-md5</div>
<div id="t3v_10" class="t s2_10">, where fully 3% of bytecodes are executed while</div>
<div id="t3w_10" class="t s2_10">recording. In most of the tests, almost all the bytecodes are exe-</div>
<div id="t3x_10" class="t s2_10">cuted by compiled traces. Three of the benchmarks are not traced</div>
<div id="t3y_10" class="t s2_10">at all and run in the interpreter.</div>
<div id="t3z_10" class="t s2_10">loops and heavily branching code, and a specialized fuzz tester in-</div>
<div id="t40_10" class="t s2_10">deed revealed several regressions which we subsequently corrected.</div>
<div id="t41_10" class="t s7_10">7.</div>
<div id="t42_10" class="t s7_10">Evaluation</div>
<div id="t43_10" class="t s2_10">We evaluated our JavaScript tracing implementation using Sun-</div>
<div id="t44_10" class="t s2_10">Spider, the industry standard JavaScript benchmark suite. SunSpi-</div>
<div id="t45_10" class="t s2_10">der consists of 26 short-running (less than 250ms, average 26ms)</div>
<div id="t46_10" class="t s2_10">JavaScript programs. This is in stark contrast to benchmark suites</div>
<div id="t47_10" class="t s2_10">such as SpecJVM98 (3) used to evaluate desktop and server Java</div>
<div id="t48_10" class="t s2_10">VMs. Many programs in those benchmarks use large data sets and</div>
<div id="t49_10" class="t s2_10">execute for minutes. The SunSpider programs carry out a variety of</div>
<div id="t4a_10" class="t s2_10">tasks, primarily 3d rendering, bit-bashing, cryptographic encoding,</div>
<div id="t4b_10" class="t s2_10">math kernels, and string processing.</div>
<div id="t4c_10" class="t s2_10">All experiments were performed on a MacBook Pro with 2.2</div>
<div id="t4d_10" class="t s2_10">GHz Core 2 processor and 2 GB RAM running MacOS 10.5.</div>
<div id="t4e_10" class="t s1_10">Benchmark results.</div>
<div id="t4f_10" class="t s2_10">The main question is whether programs</div>
<div id="t4g_10" class="t s2_10">run faster with tracing. For this, we ran the standard SunSpider test</div>
<div id="t4h_10" class="t s2_10">driver, which starts a JavaScript interpreter, loads and runs each</div>
<div id="t4i_10" class="t s2_10">program once for warmup, then loads and runs each program 10</div>
<div id="t4j_10" class="t s2_10">times and reports the average time taken by each. We ran 4 differ-</div>
<div id="t4k_10" class="t s2_10">ent conﬁgurations for comparison: (a) SpiderMonkey, the baseline</div>
<div id="t4l_10" class="t s2_10">interpreter, (b) TraceMonkey, (d) SquirrelFish Extreme (SFX), the</div>
<div id="t4m_10" class="t s2_10">call-threaded JavaScript interpreter used in Apple’s WebKit, and</div>
<div id="t4n_10" class="t s2_10">(e) V8, the method-compiling JavaScript VM from Google.</div>
<div id="t4o_10" class="t s2_10">Figure 10 shows the relative speedups achieved by tracing, SFX,</div>
<div id="t4p_10" class="t s2_10">and V8 against the baseline (SpiderMonkey). Tracing achieves the</div>
<div id="t4q_10" class="t s2_10">best speedups in integer-heavy benchmarks, up to the 25x speedup</div>
<div id="t4r_10" class="t s2_10">on</div>
<div id="t4s_10" class="t s3_10">bitops-bitwise-and</div>
<div id="t4t_10" class="t s2_10">.</div>
<div id="t4u_10" class="t s2_10">TraceMonkey is the fastest VM on 9 of the 26 benchmarks</div>
<div id="t4v_10" class="t s2_10">(</div>
<div id="t4w_10" class="t s3_10">3d-morph</div>
<div id="t4x_10" class="t s2_10">,</div>
<div id="t4y_10" class="t s3_10">bitops-3bit-bits-in-byte</div>
<div id="t4z_10" class="t s2_10">,</div>
<div id="t50_10" class="t s3_10">bitops-bitwise-</div>
<div id="t51_10" class="t s3_10">and</div>
<div id="t52_10" class="t s2_10">,</div>
<div id="t53_10" class="t s3_10">crypto-sha1</div>
<div id="t54_10" class="t s2_10">,</div>
<div id="t55_10" class="t s3_10">math-cordic</div>
<div id="t56_10" class="t s2_10">,</div>
<div id="t57_10" class="t s3_10">math-partial-sums</div>
<div id="t58_10" class="t s2_10">,</div>
<div id="t59_10" class="t s3_10">math-</div>
<div id="t5a_10" class="t s3_10">spectral-norm</div>
<div id="t5b_10" class="t s2_10">,</div>
<div id="t5c_10" class="t s3_10">string-base64</div>
<div id="t5d_10" class="t s2_10">,</div>
<div id="t5e_10" class="t s3_10">string-validate-input</div>
<div id="t5f_10" class="t s2_10">).</div>

<!-- End text definitions -->


</div>
</body>
</html>
